{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport \"core-js/modules/es.iterator.constructor.js\";\nimport \"core-js/modules/es.iterator.find.js\";\nimport \"core-js/modules/es.iterator.map.js\";\nimport * as echarts from 'echarts';\nimport markerIcon from '@/assets/imgs/icons8-åœˆå‘ä¸Š-64.png';\nexport default {\n  name: 'FarmMonitor',\n  // é¿å…ä½¿ç”¨HTMLä¿ç•™æ ‡ç­¾ä½œä¸ºç»„ä»¶å\n  data() {\n    return {\n      // æ ¸å¿ƒæ•°æ®\n      weather: {\n        date: `${new Date().getMonth() + 1}æœˆ${new Date().getDate()}æ—¥`,\n        weekday: ['å‘¨æ—¥', 'å‘¨ä¸€', 'å‘¨äºŒ', 'å‘¨ä¸‰', 'å‘¨å››', 'å‘¨äº”', 'å‘¨å…­'][new Date().getDay()],\n        weather: 'æ™´',\n        tempMin: 18,\n        tempMax: 30,\n        windDir: 'ä¸œé£',\n        windForce: '3çº§'\n      },\n      currDate: new Date().toLocaleDateString(),\n      temp: 22,\n      hum: 50,\n      tempHistory: [{\n        time: '00:00',\n        value: 22\n      }, {\n        time: '00:05',\n        value: 22.5\n      }],\n      humHistory: [{\n        time: '00:00',\n        value: 50\n      }, {\n        time: '00:05',\n        value: 49.5\n      }],\n      tempRange: {\n        min: 18,\n        max: 26\n      },\n      humRange: {\n        min: 40,\n        max: 60\n      },\n      // æ–°å¢WebSocketå’ŒWorkerç›¸å…³çŠ¶æ€\n      worker: null,\n      workerPort: null,\n      // è®¾å¤‡æ•°æ®\n      water: {\n        status: 0,\n        value: 0\n      },\n      weight: 50,\n      devices: [{\n        name: 'æ°´æ³µ',\n        status: 0\n      }, {\n        name: 'ç”µæœº',\n        status: 0\n      }, {\n        name: 'ç¯å…‰',\n        status: 0\n      }, {\n        name: 'é˜€é—¨',\n        status: 0\n      }, {\n        name: 'åŠ çƒ­',\n        status: 0\n      }, {\n        name: 'é£æœº',\n        status: 0\n      }],\n      // è¿æ¥çŠ¶æ€\n      mainConn: false,\n      lastUpdate: '-',\n      maxHistory: 10,\n      // è¿›åº¦æ¡ç›¸å…³é…ç½®\n      barHeight: 120,\n      // è¿›åº¦æ¡é«˜åº¦\n      colors: ['#43a047', '#8bc34a', '#cddc39'],\n      // è¿›åº¦æ¡æ¸å˜é¢œè‰²\n\n      // åœ°å›¾ç›¸å…³\n      lnglat: '',\n      course: '',\n      mapStatus: 'åœ°å›¾åŠ è½½ä¸­...',\n      mapConn: false,\n      map: null,\n      marker: null,\n      // å›¾è¡¨å®ä¾‹\n      tempChart: null,\n      humChart: null\n    };\n  },\n  computed: {\n    // è®¡ç®—å±æ€§ï¼ˆVue 2 ä¸­ä½¿ç”¨ function è¯­æ³•ï¼‰\n    weightPercent() {\n      return Math.max(0, Math.min(100, Math.round(this.weight)));\n    },\n    tempWarn() {\n      return this.temp < this.tempRange.min || this.temp > this.tempRange.max;\n    },\n    humWarn() {\n      return this.hum < this.humRange.min || this.hum > this.humRange.max;\n    },\n    waterAlarm() {\n      return this.water.value > 8.5 || this.water.value < 2.0;\n    },\n    gradientBg() {\n      return `linear-gradient(to top, ${this.colors.join(', ')})`;\n    }\n  },\n  methods: {\n    // å›¾è¡¨åˆå§‹åŒ–ä¸æ¸²æŸ“\n    initCharts() {\n      const tempDom = document.getElementById('tempChart');\n      const humDom = document.getElementById('humChart');\n      if (!tempDom || !humDom) return;\n      this.tempChart = echarts.init(tempDom);\n      this.humChart = echarts.init(humDom);\n      window.addEventListener('resize', () => {\n        this.tempChart?.resize();\n        this.humChart?.resize();\n      });\n      this.renderCharts();\n    },\n    renderCharts() {\n      // æ¸©åº¦å›¾è¡¨é…ç½®\n      this.tempChart.setOption({\n        tooltip: {\n          trigger: 'axis'\n        },\n        grid: {\n          left: '3%',\n          right: '4%',\n          bottom: '3%',\n          containLabel: true\n        },\n        xAxis: {\n          type: 'category',\n          data: this.tempHistory.map(i => i.time),\n          axisLabel: {\n            rotate: 30\n          }\n        },\n        yAxis: {\n          type: 'value',\n          name: 'æ¸©åº¦(Â°C)',\n          min: Math.min(...this.tempHistory.map(i => i.value), this.tempRange.min) - 2,\n          max: Math.max(...this.tempHistory.map(i => i.value), this.tempRange.max) + 2,\n          markLine: {\n            data: [{\n              yAxis: this.tempRange.min,\n              name: 'æœ€ä½é˜ˆå€¼',\n              lineStyle: {\n                color: 'red'\n              }\n            }, {\n              yAxis: this.tempRange.max,\n              name: 'æœ€é«˜é˜ˆå€¼',\n              lineStyle: {\n                color: 'red'\n              }\n            }]\n          }\n        },\n        series: [{\n          name: 'æ¸©åº¦',\n          type: 'line',\n          data: this.tempHistory.map(i => i.value),\n          smooth: true,\n          lineStyle: {\n            color: '#e74c3c'\n          },\n          itemStyle: {\n            color: '#e74c3c'\n          },\n          areaStyle: {\n            color: new echarts.graphic.LinearGradient(0, 0, 0, 1, [{\n              offset: 0,\n              color: 'rgba(231,76,60,0.3)'\n            }, {\n              offset: 1,\n              color: 'rgba(231,76,60,0)'\n            }])\n          }\n        }]\n      });\n\n      // æ¹¿åº¦å›¾è¡¨é…ç½®\n      this.humChart.setOption({\n        tooltip: {\n          trigger: 'axis'\n        },\n        grid: {\n          left: '3%',\n          right: '4%',\n          bottom: '3%',\n          containLabel: true\n        },\n        xAxis: {\n          type: 'category',\n          data: this.humHistory.map(i => i.time),\n          axisLabel: {\n            rotate: 30\n          }\n        },\n        yAxis: {\n          type: 'value',\n          name: 'æ¹¿åº¦(%)',\n          min: Math.min(...this.humHistory.map(i => i.value), this.humRange.min) - 5,\n          max: Math.max(...this.humHistory.map(i => i.value), this.humRange.max) + 5,\n          markLine: {\n            data: [{\n              yAxis: this.humRange.min,\n              name: 'æœ€ä½é˜ˆå€¼',\n              lineStyle: {\n                color: 'blue'\n              }\n            }, {\n              yAxis: this.humRange.max,\n              name: 'æœ€é«˜é˜ˆå€¼',\n              lineStyle: {\n                color: 'blue'\n              }\n            }]\n          }\n        },\n        series: [{\n          name: 'æ¹¿åº¦',\n          type: 'line',\n          data: this.humHistory.map(i => i.value),\n          smooth: true,\n          lineStyle: {\n            color: '#3498db'\n          },\n          itemStyle: {\n            color: '#3498db'\n          },\n          areaStyle: {\n            color: new echarts.graphic.LinearGradient(0, 0, 0, 1, [{\n              offset: 0,\n              color: 'rgba(52,152,219,0.3)'\n            }, {\n              offset: 1,\n              color: 'rgba(52,152,219,0)'\n            }])\n          }\n        }]\n      });\n    },\n    // å†å²æ•°æ®æ›´æ–°\n    updateHistory(ref, val, time) {\n      ref.push({\n        time,\n        value: val\n      });\n      if (ref.length > this.maxHistory) ref.shift();\n    },\n    // åœ°å›¾åˆå§‹åŒ–\n    initMap() {\n      const loadMap = () => new Promise((res, rej) => {\n        if (window.AMap) return res(window.AMap);\n        const script = document.createElement('script');\n        script.src = 'https://webapi.amap.com/maps?v=1.4.15&key=ä½ çš„é«˜å¾·Key'; // æ›¿æ¢ä¸ºä½ çš„é«˜å¾·Key\n        script.onload = () => res(window.AMap || rej(new Error('åœ°å›¾åŠ è½½å¤±è´¥')));\n        script.onerror = () => rej(new Error('åœ°å›¾è„šæœ¬åŠ è½½å¤±è´¥'));\n        document.head.appendChild(script);\n      });\n      loadMap().then(AMap => {\n        this.map = new AMap.Map('map', {\n          resizeEnable: true,\n          zoom: 16,\n          center: [116.397470, 39.908823],\n          viewMode: '2D'\n        });\n        this.marker = new AMap.Marker({\n          position: [116.397470, 39.908823],\n          icon: new AMap.Icon({\n            size: new AMap.Size(32, 32),\n            image: markerIcon,\n            imageSize: new AMap.Size(64, 64),\n            imageOffset: new AMap.Pixel(-16, -16)\n          }),\n          anchor: 'center'\n        });\n        this.map.add(this.marker);\n        this.map.on('complete', () => this.mapStatus = 'åœ°å›¾å·²å°±ç»ª');\n        this.map.on('error', () => this.mapStatus = 'åœ°å›¾æ¸²æŸ“é”™è¯¯');\n      }).catch(err => {\n        this.mapStatus = 'åœ°å›¾åŠ è½½å¤±è´¥';\n        console.error(err);\n      });\n    },\n    // æ•°æ®åˆ·æ–°\n    // æ–°å¢: åˆå§‹åŒ–SharedWorker\n    initWorker() {\n      if (!window.SharedWorker) {\n        console.error('å½“å‰æµè§ˆå™¨ä¸æ”¯æŒSharedWorker');\n        return;\n      }\n      try {\n        this.worker = new SharedWorker('/websocket-shared-worker.js');\n        this.workerPort = this.worker.port;\n\n        // ç›‘å¬Workeræ¶ˆæ¯\n        this.workerPort.onmessage = event => {\n          this.handleWorkerMessage(event.data);\n        };\n\n        // ç›‘å¬é”™è¯¯\n        this.workerPort.onerror = error => {\n          console.error('Worker error:', error);\n          this.mainConn = false;\n          this.mapConn = false;\n        };\n\n        // å¯åŠ¨è¿æ¥\n        this.workerPort.start();\n      } catch (error) {\n        console.error('åˆå§‹åŒ–SharedWorkerå¤±è´¥:', error);\n      }\n    },\n    // æ–°å¢: å¤„ç†Workeræ¶ˆæ¯\n    handleWorkerMessage(message) {\n      switch (message.type) {\n        case 'CONNECTED':\n          this.mainConn = true;\n          this.mapConn = true;\n          break;\n        case 'DISCONNECTED':\n          this.mainConn = false;\n          this.mapConn = false;\n          break;\n        case 'ERROR':\n          console.error('WebSocketé”™è¯¯:', message.data);\n          this.mainConn = false;\n          this.mapConn = false;\n          break;\n        case 'MAIN_DATA':\n          this.handleMainData(message.data);\n          break;\n        case 'MAP_DATA':\n          this.handleMapData(message.data);\n          break;\n        default:\n          console.log('æœªçŸ¥æ¶ˆæ¯ç±»å‹:', message.type);\n      }\n    },\n    // ä¿®æ”¹: æ•°æ®åˆ·æ–°æ–¹æ³•\n    refresh() {\n      if (this.workerPort) {\n        this.workerPort.postMessage({\n          type: 'REFRESH_DATA'\n        });\n        this.lastUpdate = new Date().toLocaleString();\n      }\n    },\n    // å¤„ç†ä¸»æ•°æ®æ›´æ–°çš„å›è°ƒå‡½æ•°\n    handleMainData(data) {\n      try {\n        this.temp = data.T || data.tem || this.temp;\n        this.hum = data.H || data.hum || this.hum;\n        this.water = {\n          status: data.waterStatus || 0,\n          value: data.water_level || 0\n        };\n        this.weight = Math.max(0, Math.min(100, parseFloat(data.weight) || 0));\n\n        // æ›´æ–°è®¾å¤‡çŠ¶æ€\n        this.devices.find(d => d.name === 'æ°´æ³µ').status = data.pump || 0;\n        this.devices.find(d => d.name === 'ç”µæœº').status = data.motor || 0;\n        this.devices.find(d => d.name === 'ç¯å…‰').status = data.light || 0;\n        this.devices.find(d => d.name === 'é˜€é—¨').status = data.door || 0;\n        this.devices.find(d => d.name === 'åŠ çƒ­').status = data.heat || 0;\n        this.devices.find(d => d.name === 'é£æœº').status = data.fan || 0;\n\n        // æ›´æ–°å†å²æ•°æ®\n        const timeStr = new Date().toLocaleTimeString();\n        this.updateHistory(this.tempHistory, this.temp, timeStr);\n        this.updateHistory(this.humHistory, this.hum, timeStr);\n        this.lastUpdate = new Date().toLocaleString();\n        this.currDate = new Date().toLocaleDateString();\n        this.renderCharts();\n        this.mainConn = true;\n      } catch (e) {\n        this.mainConn = false;\n        console.error('å¤„ç†ä¸»æ•°æ®å¤±è´¥:', e);\n      }\n    },\n    // å¤„ç†åœ°å›¾æ•°æ®æ›´æ–°çš„å›è°ƒå‡½æ•°\n    handleMapData(data) {\n      try {\n        if (data.lng !== undefined && data.lat !== undefined) {\n          const lng = parseFloat(data.lng),\n            lat = parseFloat(data.lat);\n          if (!isNaN(lng) && !isNaN(lat) && lng >= -180 && lng <= 180 && lat >= -90 && lat <= 90) {\n            this.lnglat = `${lng.toFixed(6)},${lat.toFixed(6)}`;\n            this.marker?.setPosition([lng + 0.01, lat - 0.001]);\n            this.map?.panTo([lng + 0.01, lat - 0.001], {\n              duration: 300\n            });\n          }\n        }\n        if (data.cogt !== undefined) {\n          const angle = parseFloat(data.cogt);\n          if (!isNaN(angle)) {\n            this.course = `${angle.toFixed(1)}Â°`;\n            this.marker?.setRotation((angle % 360 + 360) % 360);\n          }\n        }\n        this.mapConn = true;\n      } catch (e) {\n        this.mapConn = false;\n        console.error('å¤„ç†åœ°å›¾æ•°æ®å¤±è´¥:', e);\n      }\n    },\n    // å¤„ç†è¿æ¥çŠ¶æ€å˜åŒ–\n    handleConnectionStatus(status) {\n      this.mainConn = status;\n      this.mapConn = status;\n    }\n  },\n  mounted() {\n    // Vue 2 ä¸­ä½¿ç”¨ $nextTick\n    this.$nextTick(() => {\n      this.initCharts();\n      this.initMap();\n\n      // åˆå§‹åŒ–SharedWorker\n      this.initWorker();\n    });\n  },\n  beforeDestroy() {\n    // æ¸…ç†Workerè¿æ¥\n    if (this.workerPort) {\n      this.workerPort.close();\n      this.worker = null;\n      this.workerPort = null;\n    }\n\n    // æ¸…ç†å›¾è¡¨å’Œåœ°å›¾\n    if (this.tempChart) this.tempChart.dispose();\n    if (this.humChart) this.humChart.dispose();\n    if (this.map) this.map.destroy();\n  }\n};","map":{"version":3,"names":["echarts","markerIcon","name","data","weather","date","Date","getMonth","getDate","weekday","getDay","tempMin","tempMax","windDir","windForce","currDate","toLocaleDateString","temp","hum","tempHistory","time","value","humHistory","tempRange","min","max","humRange","worker","workerPort","water","status","weight","devices","mainConn","lastUpdate","maxHistory","barHeight","colors","lnglat","course","mapStatus","mapConn","map","marker","tempChart","humChart","computed","weightPercent","Math","round","tempWarn","humWarn","waterAlarm","gradientBg","join","methods","initCharts","tempDom","document","getElementById","humDom","init","window","addEventListener","resize","renderCharts","setOption","tooltip","trigger","grid","left","right","bottom","containLabel","xAxis","type","i","axisLabel","rotate","yAxis","markLine","lineStyle","color","series","smooth","itemStyle","areaStyle","graphic","LinearGradient","offset","updateHistory","ref","val","push","length","shift","initMap","loadMap","Promise","res","rej","AMap","script","createElement","src","onload","Error","onerror","head","appendChild","then","Map","resizeEnable","zoom","center","viewMode","Marker","position","icon","Icon","size","Size","image","imageSize","imageOffset","Pixel","anchor","add","on","catch","err","console","error","initWorker","SharedWorker","port","onmessage","event","handleWorkerMessage","start","message","handleMainData","handleMapData","log","refresh","postMessage","toLocaleString","T","tem","H","waterStatus","water_level","parseFloat","find","d","pump","motor","light","door","heat","fan","timeStr","toLocaleTimeString","e","lng","undefined","lat","isNaN","toFixed","setPosition","panTo","duration","cogt","angle","setRotation","handleConnectionStatus","mounted","$nextTick","beforeDestroy","close","dispose","destroy"],"sources":["src/views/manager/details.vue"],"sourcesContent":["<template>\r\n  <div class=\"dashboard\">\r\n    <!-- æ¨¡æ¿å†…å®¹ä¿æŒä¸å˜ -->\r\n    <!-- é¡¶éƒ¨ä¿¡æ¯æ  -->\r\n    <header class=\"top-bar\">\r\n      <div class=\"title-section\">\r\n        <h1>å…»æ®–åœºç¯å¢ƒç›‘æ§ç³»ç»Ÿ</h1>\r\n        <div class=\"weather-info\">\r\n          <span>{{ weather.date }} {{ weather.weekday }}</span>\r\n          <span>{{ weather.weather }}</span>\r\n          <span>{{ weather.tempMin }}Â°~{{ weather.tempMax }}Â°</span>\r\n          <span>{{ weather.windDir }} {{ weather.windForce }}</span>\r\n        </div>\r\n      </div>\r\n      <div class=\"status-info\">\r\n        <div class=\"conn-status\">\r\n          <span class=\"dot\" :class=\"{ green: mainConn }\"></span>\r\n          <span>{{ mainConn ? 'è¿æ¥æ­£å¸¸' : 'è¿æ¥æ–­å¼€' }}</span>\r\n        </div>\r\n        <span>{{ currDate }}</span>\r\n      </div>\r\n    </header>\r\n\r\n    <!-- æ ¸å¿ƒå†…å®¹åŒº -->\r\n    <main class=\"main-content\">\r\n      <!-- ç¯å¢ƒçŠ¶æ€æŒ‡æ ‡ -->\r\n      <section class=\"status-cards\">\r\n        <h2>ç¯å¢ƒè·Ÿè¸ª</h2>\r\n        <div class=\"cards\">\r\n          <div class=\"card\" :class=\"{ warn: tempWarn }\">\r\n            <div>å½“å‰æ¸©åº¦</div>\r\n            <div class=\"val\">{{ temp.toFixed(1) }}Â°C</div>\r\n          </div>\r\n          <div class=\"card\" :class=\"{ warn: humWarn }\">\r\n            <div>å½“å‰æ¹¿åº¦</div>\r\n            <div class=\"val\">{{ hum.toFixed(1) }}%</div>\r\n          </div>\r\n        </div>\r\n      </section>\r\n\r\n      <!-- è¶‹åŠ¿å›¾è¡¨ -->\r\n      <section class=\"charts\">\r\n        <h2>ç¯å¢ƒè¶‹åŠ¿</h2>\r\n        <div class=\"charts-grid\">\r\n          <div class=\"chart-box\">\r\n            <div>æ¸©åº¦å†å²æ•°æ®</div>\r\n            <div id=\"tempChart\" class=\"chart\"></div>\r\n          </div>\r\n          <div class=\"chart-box\">\r\n            <div>æ¹¿åº¦å†å²æ•°æ®</div>\r\n            <div id=\"humChart\" class=\"chart\"></div>\r\n          </div>\r\n        </div>\r\n      </section>\r\n\r\n      <!-- è®¾å¤‡ä¸çŠ¶æ€ -->\r\n      <!-- è®¾å¤‡ä¸çŠ¶æ€ -->\r\n    <section class=\"device-info\">\r\n      <h2>è®¾å¤‡ä¸çŠ¶æ€ä¿¡æ¯</h2>\r\n      <div class=\"info-grid\">\r\n        <!-- ç½‘æ ¼å¸ƒå±€å®¹å™¨ -->\r\n        <div class=\"device-grid\">\r\n          <!-- æ°´ä½çŠ¶æ€ -->\r\n          <div class=\"card\" :class=\"{ warn: waterAlarm }\">\r\n            <div>æ°´ä½çŠ¶æ€</div>\r\n            <span class=\"status\" :class=\"{ on: water.status === 1 }\">\r\n              {{ water.status === 1 ? 'æ­£å¸¸' : 'æœ‰è¯¯' }}\r\n            </span>\r\n          </div>\r\n          \r\n          <!-- é¥²æ–™é‡é‡ -->\r\n          <div class=\"card feed-card\">\r\n            <div>é¥²æ–™é‡é‡çŠ¶æ€å€¼</div>\r\n            <div class=\"progress-container\">\r\n              <div class=\"progress-bar\" :style=\"{ height: barHeight + 'px' }\">\r\n                <div \r\n                  class=\"progress-fill\" \r\n                  :class=\"{ low: weightPercent < 20 }\"\r\n                  :style=\"{ \r\n                    height: weightPercent + '%',\r\n                    background: gradientBg \r\n                  }\"\r\n                ></div>\r\n                <div \r\n                  class=\"progress-marker\"\r\n                  :style=\"{ bottom: weightPercent + '%' }\"\r\n                ></div>\r\n              </div>\r\n              <div class=\"weight-info\">\r\n                <span>{{ weight.toFixed(1) }}g</span>\r\n                <span>{{ weightPercent }}%</span>\r\n                <span v-if=\"weightPercent < 20\" class=\"low-warning\">\r\n                  é¥²æ–™ä¸è¶³ï¼Œè¯·è¡¥å……!\r\n                </span>\r\n              </div>\r\n            </div>\r\n          </div>\r\n          \r\n          <!-- æ°´æ³µè®¾å¤‡ -->\r\n          <div class=\"card device-card\">\r\n            <div class=\"icon\">ğŸ’§</div>\r\n            <div>æ°´æ³µçŠ¶æ€</div>\r\n            <span class=\"status\" :class=\"{ on: devices[0].status === 1 }\">\r\n              {{ devices[0].status === 1 ? 'è¿è¡Œä¸­' : 'å·²å…³é—­' }}\r\n            </span>\r\n          </div>\r\n          \r\n          <!-- ç”µæœºè®¾å¤‡ -->\r\n          <div class=\"card device-card\">\r\n            <div class=\"icon\">ğŸ”Š</div>\r\n            <div>ç”µæœºçŠ¶æ€</div>\r\n            <span class=\"status\" :class=\"{ on: devices[1].status === 1 }\">\r\n              {{ devices[1].status === 1 ? 'è¿è¡Œä¸­' : 'å·²å…³é—­' }}\r\n            </span>\r\n          </div>\r\n          \r\n          <!-- ç¯å…‰è®¾å¤‡ -->\r\n          <div class=\"card device-card\">\r\n            <div class=\"icon\">ğŸ’¡</div>\r\n            <div>ç¯å…‰çŠ¶æ€</div>\r\n            <span class=\"status\" :class=\"{ on: devices[2].status === 1 }\">\r\n              {{ devices[2].status === 1 ? 'è¿è¡Œä¸­' : 'å·²å…³é—­' }}\r\n            </span>\r\n          </div>\r\n          \r\n          <!-- é˜€é—¨è®¾å¤‡ -->\r\n          <div class=\"card device-card\">\r\n            <div class=\"icon\">ğŸšª</div>\r\n            <div>é˜€é—¨çŠ¶æ€</div>\r\n            <span class=\"status\" :class=\"{ on: devices[3].status === 1 }\">\r\n              {{ devices[3].status === 1 ? 'è¿è¡Œä¸­' : 'å·²å…³é—­' }}\r\n            </span>\r\n          </div>\r\n          \r\n          <!-- åŠ çƒ­è®¾å¤‡ -->\r\n          <div class=\"card device-card\">\r\n            <div class=\"icon\">ğŸ”¥</div>\r\n            <div>åŠ çƒ­çŠ¶æ€</div>\r\n            <span class=\"status\" :class=\"{ on: devices[4].status === 1 }\">\r\n              {{ devices[4].status === 1 ? 'è¿è¡Œä¸­' : 'å·²å…³é—­' }}\r\n            </span>\r\n          </div>\r\n          \r\n          <!-- é£æœºè®¾å¤‡ -->\r\n          <div class=\"card device-card\">\r\n            <div class=\"icon\">ğŸ’¨</div>\r\n            <div>é£æœºçŠ¶æ€</div>\r\n            <span class=\"status\" :class=\"{ on: devices[5].status === 1 }\">\r\n              {{ devices[5].status === 1 ? 'è¿è¡Œä¸­' : 'å·²å…³é—­' }}\r\n            </span>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </section>\r\n\r\n      <!-- åœ°å›¾åŒºåŸŸ -->\r\n      <section class=\"map-section\">\r\n        <h2>ä½ç½®ç›‘æ§</h2>\r\n        <div class=\"map-container\">\r\n          <div id=\"map\" class=\"map-view\"></div>\r\n          <div class=\"map-status\">\r\n            <span>åœ°å›¾åç«¯è¿æ¥: </span>\r\n            <span :class=\"{ online: mapConn }\">{{ mapConn ? 'å·²è¿æ¥' : 'å·²æ–­å¼€' }}</span>\r\n            <span class=\"map-dot\" :class=\"{ green: mapConn }\"></span>\r\n          </div>\r\n          <div class=\"map-data\">\r\n            <div><span>ç»çº¬åº¦:</span> <span>{{ lnglat || 'ç­‰å¾…æ•°æ®...' }}</span></div>\r\n            <div><span>èˆªå‘è§’:</span> <span>{{ course || '0Â°' }}</span></div>\r\n            <div><span>åœ°å›¾çŠ¶æ€:</span> <span>{{ mapStatus }}</span></div>\r\n          </div>\r\n        </div>\r\n      </section>\r\n    </main>\r\n\r\n    <footer class=\"footer\">\r\n      <div>æœ€åæ›´æ–°æ—¶é—´: {{ lastUpdate }}</div>\r\n      <button class=\"refresh\" @click=\"refresh\">\r\n        <i class=\"fa fa-refresh\"></i> åˆ·æ–°æ•°æ®\r\n      </button>\r\n    </footer>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport * as echarts from 'echarts'\r\nimport markerIcon from '@/assets/imgs/icons8-åœˆå‘ä¸Š-64.png'\r\n\r\nexport default {\r\n  name: 'FarmMonitor', // é¿å…ä½¿ç”¨HTMLä¿ç•™æ ‡ç­¾ä½œä¸ºç»„ä»¶å\r\n  data() {\r\n    return {\r\n      // æ ¸å¿ƒæ•°æ®\r\n      weather: {\r\n        date: `${new Date().getMonth() + 1}æœˆ${new Date().getDate()}æ—¥`,\r\n        weekday: ['å‘¨æ—¥', 'å‘¨ä¸€', 'å‘¨äºŒ', 'å‘¨ä¸‰', 'å‘¨å››', 'å‘¨äº”', 'å‘¨å…­'][new Date().getDay()],\r\n        weather: 'æ™´',\r\n        tempMin: 18,\r\n        tempMax: 30,\r\n        windDir: 'ä¸œé£',\r\n        windForce: '3çº§'\r\n      },\r\n      currDate: new Date().toLocaleDateString(),\r\n      temp: 22,\r\n      hum: 50,\r\n      tempHistory: [{ time: '00:00', value: 22 }, { time: '00:05', value: 22.5 }],\r\n      humHistory: [{ time: '00:00', value: 50 }, { time: '00:05', value: 49.5 }],\r\n      tempRange: { min: 18, max: 26 },\r\n      humRange: { min: 40, max: 60 },\r\n\r\n      // SSEè¿æ¥çŠ¶æ€\r\n      mainEs: null,\r\n      mapEs: null,\r\n      backendUrl: 'http://localhost:9090',\r\n      // è®¾å¤‡æ•°æ®\r\n      water: { status: 0, value: 0 },\r\n      weight: 50,\r\n      devices: [\r\n        { name: 'æ°´æ³µ', status: 0 },\r\n        { name: 'ç”µæœº', status: 0 },\r\n        { name: 'ç¯å…‰', status: 0 },\r\n        { name: 'é˜€é—¨', status: 0 },\r\n        { name: 'åŠ çƒ­', status: 0 },\r\n        { name: 'é£æœº', status: 0 }\r\n      ],\r\n\r\n      // è¿æ¥çŠ¶æ€\r\n      mainConn: false,\r\n      lastUpdate: '-',\r\n      maxHistory: 10,\r\n\r\n      // è¿›åº¦æ¡ç›¸å…³é…ç½®\r\n      barHeight: 120, // è¿›åº¦æ¡é«˜åº¦\r\n      colors: ['#43a047', '#8bc34a', '#cddc39'], // è¿›åº¦æ¡æ¸å˜é¢œè‰²\r\n\r\n      // åœ°å›¾ç›¸å…³\r\n      lnglat: '',\r\n      course: '',\r\n      mapStatus: 'åœ°å›¾åŠ è½½ä¸­...',\r\n      mapConn: false,\r\n      map: null,\r\n      marker: null,\r\n\r\n      // å›¾è¡¨å®ä¾‹\r\n      tempChart: null,\r\n      humChart: null\r\n    }\r\n  },\r\n  computed: {\r\n    // è®¡ç®—å±æ€§ï¼ˆVue 2 ä¸­ä½¿ç”¨ function è¯­æ³•ï¼‰\r\n    weightPercent() {\r\n      return Math.max(0, Math.min(100, Math.round(this.weight)))\r\n    },\r\n    tempWarn() {\r\n      return this.temp < this.tempRange.min || this.temp > this.tempRange.max\r\n    },\r\n    humWarn() {\r\n      return this.hum < this.humRange.min || this.hum > this.humRange.max\r\n    },\r\n    waterAlarm() {\r\n      return this.water.value > 8.5 || this.water.value < 2.0\r\n    },\r\n    gradientBg() {\r\n      return `linear-gradient(to top, ${this.colors.join(', ')})`\r\n    }\r\n  },\r\n  methods: {\r\n    // å›¾è¡¨åˆå§‹åŒ–ä¸æ¸²æŸ“\r\n    initCharts() {\r\n      const tempDom = document.getElementById('tempChart')\r\n      const humDom = document.getElementById('humChart')\r\n      if (!tempDom || !humDom) return\r\n\r\n      this.tempChart = echarts.init(tempDom)\r\n      this.humChart = echarts.init(humDom)\r\n      \r\n      window.addEventListener('resize', () => {\r\n        this.tempChart?.resize()\r\n        this.humChart?.resize()\r\n      })\r\n      this.renderCharts()\r\n    },\r\n    renderCharts() {\r\n      // æ¸©åº¦å›¾è¡¨é…ç½®\r\n      this.tempChart.setOption({\r\n        tooltip: { trigger: 'axis' },\r\n        grid: { left: '3%', right: '4%', bottom: '3%', containLabel: true },\r\n        xAxis: { \r\n          type: 'category', \r\n          data: this.tempHistory.map(i => i.time),\r\n          axisLabel: { rotate: 30 } \r\n        },\r\n        yAxis: {\r\n          type: 'value',\r\n          name: 'æ¸©åº¦(Â°C)',\r\n          min: Math.min(...this.tempHistory.map(i => i.value), this.tempRange.min) - 2,\r\n          max: Math.max(...this.tempHistory.map(i => i.value), this.tempRange.max) + 2,\r\n          markLine: {\r\n            data: [\r\n              { yAxis: this.tempRange.min, name: 'æœ€ä½é˜ˆå€¼', lineStyle: { color: 'red' } },\r\n              { yAxis: this.tempRange.max, name: 'æœ€é«˜é˜ˆå€¼', lineStyle: { color: 'red' } }\r\n            ]\r\n          }\r\n        },\r\n        series: [{\r\n          name: 'æ¸©åº¦',\r\n          type: 'line',\r\n          data: this.tempHistory.map(i => i.value),\r\n          smooth: true,\r\n          lineStyle: { color: '#e74c3c' },\r\n          itemStyle: { color: '#e74c3c' },\r\n          areaStyle: { color: new echarts.graphic.LinearGradient(0,0,0,1,[\r\n            { offset: 0, color: 'rgba(231,76,60,0.3)' },\r\n            { offset: 1, color: 'rgba(231,76,60,0)' }\r\n          ])}\r\n        }]\r\n      })\r\n\r\n      // æ¹¿åº¦å›¾è¡¨é…ç½®\r\n      this.humChart.setOption({\r\n        tooltip: { trigger: 'axis' },\r\n        grid: { left: '3%', right: '4%', bottom: '3%', containLabel: true },\r\n        xAxis: { type: 'category', data: this.humHistory.map(i => i.time), axisLabel: { rotate: 30 } },\r\n        yAxis: {\r\n          type: 'value',\r\n          name: 'æ¹¿åº¦(%)',\r\n          min: Math.min(...this.humHistory.map(i => i.value), this.humRange.min) - 5,\r\n          max: Math.max(...this.humHistory.map(i => i.value), this.humRange.max) + 5,\r\n          markLine: {\r\n            data: [\r\n              { yAxis: this.humRange.min, name: 'æœ€ä½é˜ˆå€¼', lineStyle: { color: 'blue' } },\r\n              { yAxis: this.humRange.max, name: 'æœ€é«˜é˜ˆå€¼', lineStyle: { color: 'blue' } }\r\n            ]\r\n          }\r\n        },\r\n        series: [{\r\n          name: 'æ¹¿åº¦',\r\n          type: 'line',\r\n          data: this.humHistory.map(i => i.value),\r\n          smooth: true,\r\n          lineStyle: { color: '#3498db' },\r\n          itemStyle: { color: '#3498db' },\r\n          areaStyle: { color: new echarts.graphic.LinearGradient(0,0,0,1,[\r\n            { offset: 0, color: 'rgba(52,152,219,0.3)' },\r\n            { offset: 1, color: 'rgba(52,152,219,0)' }\r\n          ])}\r\n        }]\r\n      })\r\n    },\r\n\r\n    // å†å²æ•°æ®æ›´æ–°\r\n    updateHistory(ref, val, time) {\r\n      ref.push({ time, value: val })\r\n      if (ref.length > this.maxHistory) ref.shift()\r\n    },\r\n\r\n    // åœ°å›¾åˆå§‹åŒ–\r\n    initMap() {\r\n      const loadMap = () => new Promise((res, rej) => {\r\n        if (window.AMap) return res(window.AMap)\r\n        const script = document.createElement('script')\r\n        script.src = 'https://webapi.amap.com/maps?v=1.4.15&key=ä½ çš„é«˜å¾·Key' // æ›¿æ¢ä¸ºä½ çš„é«˜å¾·Key\r\n        script.onload = () => res(window.AMap || rej(new Error('åœ°å›¾åŠ è½½å¤±è´¥')))\r\n        script.onerror = () => rej(new Error('åœ°å›¾è„šæœ¬åŠ è½½å¤±è´¥'))\r\n        document.head.appendChild(script)\r\n      })\r\n\r\n      loadMap().then(AMap => {\r\n        this.map = new AMap.Map('map', {\r\n          resizeEnable: true,\r\n          zoom: 16,\r\n          center: [116.397470, 39.908823],\r\n          viewMode: '2D'\r\n        })\r\n        \r\n        this.marker = new AMap.Marker({\r\n          position: [116.397470, 39.908823],\r\n          icon: new AMap.Icon({\r\n            size: new AMap.Size(32, 32),\r\n            image: markerIcon,\r\n            imageSize: new AMap.Size(64, 64),\r\n            imageOffset: new AMap.Pixel(-16, -16)\r\n          }),\r\n          anchor: 'center'\r\n        })\r\n        this.map.add(this.marker)\r\n        \r\n        this.map.on('complete', () => this.mapStatus = 'åœ°å›¾å·²å°±ç»ª')\r\n        this.map.on('error', () => this.mapStatus = 'åœ°å›¾æ¸²æŸ“é”™è¯¯')\r\n      }).catch(err => {\r\n        this.mapStatus = 'åœ°å›¾åŠ è½½å¤±è´¥'\r\n        console.error(err)\r\n      })\r\n    },\r\n\r\n    // æ•°æ®åˆ·æ–°\r\n    // åˆ›å»ºSSEè¿æ¥\r\n    createSSE(url, eventName) {\r\n      // å…³é—­å·²å­˜åœ¨çš„è¿æ¥\r\n      if (eventName === 'main' && this.mainEs) this.mainEs.close()\r\n      if (eventName === 'map' && this.mapEs) this.mapEs.close()\r\n\r\n      const es = new EventSource(url)\r\n\r\n      // è¿æ¥æˆåŠŸå¤„ç†\r\n      es.addEventListener('connected', () => {\r\n        this.mainConn = true\r\n        this.mapConn = true\r\n        console.log(`${eventName} SSEè¿æ¥æˆåŠŸ`)\r\n      })\r\n\r\n      // æ¥æ”¶æ¶ˆæ¯å¤„ç†\r\n      es.onmessage = (ev) => {\r\n        try {\r\n          const data = JSON.parse(ev.data)\r\n          if (eventName === 'main') {\r\n            this.handleMainData(data)\r\n          } else if (eventName === 'map') {\r\n            this.handleMapData(data)\r\n          }\r\n        } catch (e) {\r\n          console.error(`${eventName} SSEæ•°æ®è§£æå¤±è´¥:`, e)\r\n        }\r\n      }\r\n\r\n      // é”™è¯¯å¤„ç†ä¸é‡è¿\r\n      es.onerror = () => {\r\n        this.mainConn = false\r\n        this.mapConn = false\r\n        console.error(`${eventName} SSEè¿æ¥é”™è¯¯ï¼Œå°è¯•é‡è¿...`)\r\n        setTimeout(() => this.createSSE(url, eventName), 5000)\r\n      }\r\n\r\n      // ä¿å­˜è¿æ¥å®ä¾‹\r\n      if (eventName === 'main') this.mainEs = es\r\n      if (eventName === 'map') this.mapEs = es\r\n\r\n      return es\r\n    },\r\n\r\n    // åˆå§‹åŒ–SSEè¿æ¥\r\n    initSSEConnections() {\r\n      this.createSSE(`${this.backendUrl}/sse/subscribe`, 'main')\r\n      this.createSSE(`${this.backendUrl}/sse/subscribe`, 'map')\r\n    },\r\n\r\n    // å…³é—­SSEè¿æ¥\r\n    closeSSEConnections() {\r\n      if (this.mainEs) this.mainEs.close()\r\n      if (this.mapEs) this.mapEs.close()\r\n      this.mainConn = false\r\n      this.mapConn = false\r\n    },\r\n\r\n    // æ•°æ®åˆ·æ–°æ–¹æ³•\r\n    refresh() {\r\n      this.lastUpdate = new Date().toLocaleString();\r\n    },\r\n\r\n\r\n\r\n    // å¤„ç†ä¸»æ•°æ®æ›´æ–°çš„å›è°ƒå‡½æ•°\r\n    handleMainData(data) {\r\n      try {\r\n        this.temp = data.T || data.tem || this.temp\r\n        this.hum = data.H || data.hum || this.hum\r\n        \r\n        this.water = {\r\n          status: data.waterStatus || 0,\r\n          value: data.water_level || 0\r\n        }\r\n        \r\n        this.weight = Math.max(0, Math.min(100, parseFloat(data.weight) || 0))\r\n\r\n        // æ›´æ–°è®¾å¤‡çŠ¶æ€\r\n        this.devices.find(d => d.name === 'æ°´æ³µ').status = data.pump || 0\r\n        this.devices.find(d => d.name === 'ç”µæœº').status = data.motor || 0\r\n        this.devices.find(d => d.name === 'ç¯å…‰').status = data.light || 0\r\n        this.devices.find(d => d.name === 'é˜€é—¨').status = data.door || 0\r\n        this.devices.find(d => d.name === 'åŠ çƒ­').status = data.heat || 0\r\n        this.devices.find(d => d.name === 'é£æœº').status = data.fan || 0\r\n        \r\n        // æ›´æ–°å†å²æ•°æ®\r\n        const timeStr = new Date().toLocaleTimeString()\r\n        this.updateHistory(this.tempHistory, this.temp, timeStr)\r\n        this.updateHistory(this.humHistory, this.hum, timeStr)\r\n        \r\n        this.lastUpdate = new Date().toLocaleString()\r\n        this.currDate = new Date().toLocaleDateString()\r\n        this.renderCharts()\r\n        this.mainConn = true\r\n      } catch (e) {\r\n        this.mainConn = false\r\n        console.error('å¤„ç†ä¸»æ•°æ®å¤±è´¥:', e)\r\n      }\r\n    },\r\n\r\n    // å¤„ç†åœ°å›¾æ•°æ®æ›´æ–°çš„å›è°ƒå‡½æ•°\r\n    handleMapData(data) {\r\n      try {\r\n        if (data.lng !== undefined && data.lat !== undefined) {\r\n          const lng = parseFloat(data.lng), lat = parseFloat(data.lat)\r\n          if (!isNaN(lng) && !isNaN(lat) && lng >= -180 && lng <= 180 && lat >= -90 && lat <= 90) {\r\n            this.lnglat = `${lng.toFixed(6)},${lat.toFixed(6)}`\r\n            this.marker?.setPosition([lng + 0.01, lat - 0.001])\r\n            this.map?.panTo([lng + 0.01, lat - 0.001], { duration: 300 })\r\n          }\r\n        }\r\n        if (data.cogt !== undefined) {\r\n          const angle = parseFloat(data.cogt)\r\n          if (!isNaN(angle)) {\r\n            this.course = `${angle.toFixed(1)}Â°`\r\n            this.marker?.setRotation(((angle % 360) + 360) % 360)\r\n          }\r\n        }\r\n        this.mapConn = true\r\n      } catch (e) {\r\n        this.mapConn = false\r\n        console.error('å¤„ç†åœ°å›¾æ•°æ®å¤±è´¥:', e)\r\n      }\r\n    },\r\n\r\n    // å¤„ç†è¿æ¥çŠ¶æ€å˜åŒ–\r\n    handleConnectionStatus(status) {\r\n      this.mainConn = status\r\n      this.mapConn = status\r\n    }\r\n  },\r\n  mounted() {\r\n    // Vue 2 ä¸­ä½¿ç”¨ $nextTick\r\n    this.$nextTick(() => {\r\n      this.initCharts()\r\n      this.initMap()\r\n      \r\n      // åˆå§‹åŒ–SSEè¿æ¥\r\n      this.initSSEConnections()\r\n    })\r\n  },\r\n  beforeDestroy() {\r\n    // å…³é—­SSEè¿æ¥\r\n    this.closeSSEConnections()\r\n\r\n    // æ¸…ç†Workerè¿æ¥ (é—ç•™ä»£ç )\r\n    if (this.workerPort) {\r\n      this.workerPort.close();\r\n      this.worker = null;\r\n      this.workerPort = null;\r\n    }\r\n\r\n\r\n\r\n    // æ¸…ç†å›¾è¡¨å’Œåœ°å›¾\r\n    if (this.tempChart) this.tempChart.dispose()\r\n    if (this.humChart) this.humChart.dispose()\r\n    if (this.map) this.map.destroy()\r\n  }\r\n}\r\n</script>\r\n\r\n<style scoped>\r\n/* æ ·å¼ä¿æŒä¸å˜ */\r\n</style> <!-- é—­åˆæ ·å¼æ ‡ç­¾ -->\r\n\r\n/* æ ·å¼ä¿æŒä¸å˜ */\r\n* { margin: 0; padding: 0; box-sizing: border-box; }\r\n.dashboard { font-family: 'Microsoft YaHei', sans-serif; display: flex; flex-direction: column; background: #f5f7fa; min-height: 100vh; }\r\n\r\n/* é¡¶éƒ¨æ  */\r\n.top-bar { display: flex; justify-content: space-between; align-items: center; padding: 1rem 2rem; background: #2c3e50; color: #fff; box-shadow: 0 2px 4px rgba(0,0,0,0.1); flex-wrap: wrap; gap: 1rem; }\r\n.weather-info { display: flex; gap: 1.5rem; font-size: 0.9rem; color: #e0e0e0; }\r\n.conn-status { display: flex; align-items: center; gap: 0.5rem; }\r\n.dot { display: inline-block; width: 10px; height: 10px; border-radius: 50%; background: #e74c3c; }\r\n.dot.green { background: #27ae60; }\r\n.currDate { font-size: 0.9rem; }\r\n\r\n/* ä¸»å†…å®¹åŒº */\r\n.main-content { flex: 1; padding: 1.5rem 2rem; display: flex; flex-direction: column; gap: 2rem; overflow-y: auto; }\r\nh2 { font-size: 1.2rem; color: #2c3e50; margin-bottom: 1rem; padding-bottom: 0.5rem; border-bottom: 1px solid #e0e0e0; }\r\n\r\n/* çŠ¶æ€å¡ç‰‡ */\r\n.status-cards .cards { display: grid; grid-template-columns: repeat(2, 1fr); gap: 1rem; height: 140px; }\r\n.card { background: #fff; border-radius: 6px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); padding: 1rem; display: flex; flex-direction: column; justify-content: center; gap: 0.5rem; }\r\n.card.warn { border-left: 4px solid #e74c3c; }\r\n.card .val { font-size: 1.8rem; font-weight: bold; color: #2c3e50; }\r\n\r\n/* å›¾è¡¨åŒºåŸŸ */\r\n.charts .charts-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 1.5rem; height: 400px; }\r\n.chart-box .chart { width: 100%; height: 100%; min-height: 250px; }\r\n\r\n\r\n.device-info .info-grid {\r\n  height: auto;\r\n  padding: 1rem;\r\n  background: #fff;\r\n  border-radius: 6px;\r\n  box-shadow: 0 2px 4px rgba(0,0,0,0.1);\r\n}\r\n\r\n.device-grid {\r\n  display: grid;\r\n  grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));\r\n  gap: 1.2rem;\r\n}\r\n\r\n/* è®¾å¤‡å¡ç‰‡é€šç”¨æ ·å¼ */\r\n.device-grid .card {\r\n  height: 100%;\r\n  left: 30%;\r\n  min-height: 120px;\r\n  display: flex;\r\n  flex-direction: column;\r\n  justify-content: center;\r\n  align-items: center;\r\n  text-align: center;\r\n  padding: 1rem;\r\n  transition: transform 0.2s ease;\r\n}\r\n\r\n.device-grid .card:hover {\r\n  transform: translateY(-3px);\r\n  box-shadow: 0 4px 8px rgba(0,0,0,0.15);\r\n}\r\n\r\n/* è®¾å¤‡å›¾æ ‡æ ·å¼ */\r\n.device-card .icon {\r\n  font-size: 1.8rem;\r\n  margin-bottom: 0.5rem;\r\n}\r\n\r\n/* é¥²æ–™å¡ç‰‡ç‰¹æ®Šè°ƒæ•´ */\r\n.feed-card {\r\n  grid-column: span 2;\r\n  min-height: 160px;\r\n}\r\n\r\n/* å“åº”å¼è°ƒæ•´ */\r\n@media (max-width: 768px) {\r\n  .device-grid {\r\n    grid-template-columns: 1fr 1fr;\r\n  }\r\n  \r\n  .feed-card {\r\n    grid-column: span 2;\r\n  }\r\n}\r\n\r\n@media (max-width: 480px) {\r\n  .device-grid {\r\n    grid-template-columns: 1fr;\r\n  }\r\n  \r\n  .feed-card {\r\n    grid-column: span 1;\r\n  }\r\n}\r\n\r\n/* é¥²æ–™é‡é‡è¿›åº¦æ¡æ ·å¼ */\r\n.feed-card .progress-container { display: flex; align-items: center; gap: 1rem; justify-content: center; flex: 1; }\r\n.progress-bar {\r\n  width: 60px;\r\n  border: 2px solid #e0e0e0;\r\n  border-radius: 10px;\r\n  position: relative;\r\n  background-color: #f5f5f5;\r\n  box-shadow: 0 0 10px rgba(0, 0, 0, 0.1) inset;\r\n}\r\n.progress-fill {\r\n  width: 100%;\r\n  position: absolute;\r\n  bottom: 0;\r\n  transition: height 0.8s ease;\r\n  border-radius: 8px;\r\n}\r\n.progress-marker {\r\n  position: absolute;\r\n  width: 100%;\r\n  height: 3px;\r\n  background-color: #333;\r\n  transform: translateY(50%);\r\n  box-shadow: 0 0 5px rgba(0, 0, 0, 0.3);\r\n}\r\n.progress-fill.low { \r\n  background: linear-gradient(to top, #e74c3c, #ff5252) !important;\r\n  animation: pulse 1.5s infinite; \r\n}\r\n.weight-info { \r\n  display: flex; \r\n  flex-direction: column; \r\n  gap: 0.5rem; \r\n  align-items: center; \r\n}\r\n.weight-info span {\r\n  font-weight: 500;\r\n}\r\n.low-warning {\r\n  color: #e74c3c;\r\n  font-size: 0.8rem;\r\n  font-weight: bold;\r\n  animation: shake 1s infinite;\r\n}\r\n\r\n/* è®¾å¤‡åˆ—è¡¨ */\r\n.device-list { display: flex; flex-direction: column; gap: 0.8rem; }\r\n.device-item { padding: 0.6rem 0.8rem; border-radius: 4px; background: #fafafa; font-size: 0.9rem; display: flex; align-items: center; gap: 0.8rem; }\r\n.icon { font-size: 1.1rem; }\r\n.status { font-weight: 500; }\r\n.status.on { color: #27ae60; }\r\n\r\n/* åœ°å›¾åŒºåŸŸ */\r\n.map-container { width: 100%; height: 600px; position: relative; border-radius: 6px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); overflow: hidden; }\r\n.map-view { width: 100%; height: 100%; }\r\n.map-status { position: absolute; top: 15px; right: 15px; background: rgba(255,255,255,0.9); padding: 0.5rem 1rem; border-radius: 4px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); font-size: 0.85rem; }\r\n.map-dot { display: inline-block; width: 8px; height: 8px; border-radius: 50%; background: #e74c3c; margin-left: 5px; }\r\n.map-dot.green { background: #27ae60; }\r\n.map-data { position: absolute; bottom: 15px; left: 15px; background: rgba(255,255,255,0.9); padding: 0.8rem; border-radius: 6px; box-shadow: 0 2px 8px rgba(0,0,0,0.15); font-size: 0.9rem; display: flex; gap: 1.5rem; }\r\n.map-data > div { display: flex; gap: 0.5rem; }\r\n\r\n/* åº•éƒ¨åŒºåŸŸ */\r\n.footer { height: 50px; display: flex; justify-content: space-between; align-items: center; padding: 0 2rem; background: #2c3e50; color: #fff; font-size: 0.9rem; }\r\n.refresh { background: #3498db; color: #fff; border: none; border-radius: 4px; padding: 0.4rem 0.8rem; display: flex; align-items: center; gap: 0.5rem; cursor: pointer; }\r\n.refresh:hover { background: #2980b9; }\r\n\r\n/* å“åº”å¼ */\r\n@media (max-width: 768px) {\r\n  .charts-grid { grid-template-columns: 1fr; height: auto; gap: 1rem; }\r\n  .chart-box { height: 400px; }\r\n  .info-grid { flex-direction: column; height: auto; gap: 1rem; }\r\n  .status-group, .device-list { height: auto; min-height: 300px; }\r\n  .map-container { height: 400px; }\r\n}\r\n\r\n/* åŠ¨ç”»æ•ˆæœ */\r\n@keyframes pulse { \r\n  0% { opacity: 1; } \r\n  50% { opacity: 0.6; } \r\n  100% { opacity: 1; } \r\n}\r\n\r\n@keyframes shake {\r\n  0%, 100% { transform: translateX(0); }\r\n  25% { transform: translateX(-3px); }\r\n  75% { transform: translateX(3px); }\r\n}\r\n</style>\r\n\r\n<template>\r\n  <div class=\"dashboard\">\r\n    <!-- æ¨¡æ¿å†…å®¹ä¿æŒä¸å˜ -->\r\n    <!-- é¡¶éƒ¨ä¿¡æ¯æ  -->\r\n    <header class=\"top-bar\">\r\n      <div class=\"title-section\">\r\n        <h1>å…»æ®–åœºç¯å¢ƒç›‘æ§ç³»ç»Ÿ</h1>\r\n        <div class=\"weather-info\">\r\n          <span>{{ weather.date }} {{ weather.weekday }}</span>\r\n          <span>{{ weather.weather }}</span>\r\n          <span>{{ weather.tempMin }}Â°~{{ weather.tempMax }}Â°</span>\r\n          <span>{{ weather.windDir }} {{ weather.windForce }}</span>\r\n        </div>\r\n      </div>\r\n      <div class=\"status-info\">\r\n        <div class=\"conn-status\">\r\n          <span class=\"dot\" :class=\"{ green: mainConn }\"></span>\r\n          <span>{{ mainConn ? 'è¿æ¥æ­£å¸¸' : 'è¿æ¥æ–­å¼€' }}</span>\r\n        </div>\r\n        <span>{{ currDate }}</span>\r\n      </div>\r\n    </header>\r\n\r\n    <!-- æ ¸å¿ƒå†…å®¹åŒº -->\r\n    <main class=\"main-content\">\r\n      <!-- ç¯å¢ƒçŠ¶æ€æŒ‡æ ‡ -->\r\n      <section class=\"status-cards\">\r\n        <h2>ç¯å¢ƒè·Ÿè¸ª</h2>\r\n        <div class=\"cards\">\r\n          <div class=\"card\" :class=\"{ warn: tempWarn }\">\r\n            <div>å½“å‰æ¸©åº¦</div>\r\n            <div class=\"val\">{{ temp.toFixed(1) }}Â°C</div>\r\n          </div>\r\n          <div class=\"card\" :class=\"{ warn: humWarn }\">\r\n            <div>å½“å‰æ¹¿åº¦</div>\r\n            <div class=\"val\">{{ hum.toFixed(1) }}%</div>\r\n          </div>\r\n        </div>\r\n      </section>\r\n\r\n      <!-- è¶‹åŠ¿å›¾è¡¨ -->\r\n      <section class=\"charts\">\r\n        <h2>ç¯å¢ƒè¶‹åŠ¿</h2>\r\n        <div class=\"charts-grid\">\r\n          <div class=\"chart-box\">\r\n            <div>æ¸©åº¦å†å²æ•°æ®</div>\r\n            <div id=\"tempChart\" class=\"chart\"></div>\r\n          </div>\r\n          <div class=\"chart-box\">\r\n            <div>æ¹¿åº¦å†å²æ•°æ®</div>\r\n            <div id=\"humChart\" class=\"chart\"></div>\r\n          </div>\r\n        </div>\r\n      </section>\r\n\r\n      <!-- è®¾å¤‡ä¸çŠ¶æ€ -->\r\n      <!-- è®¾å¤‡ä¸çŠ¶æ€ -->\r\n    <section class=\"device-info\">\r\n      <h2>è®¾å¤‡ä¸çŠ¶æ€ä¿¡æ¯</h2>\r\n      <div class=\"info-grid\">\r\n        <!-- ç½‘æ ¼å¸ƒå±€å®¹å™¨ -->\r\n        <div class=\"device-grid\">\r\n          <!-- æ°´ä½çŠ¶æ€ -->\r\n          <div class=\"card\" :class=\"{ warn: waterAlarm }\">\r\n            <div>æ°´ä½çŠ¶æ€</div>\r\n            <span class=\"status\" :class=\"{ on: water.status === 1 }\">\r\n              {{ water.status === 1 ? 'æ­£å¸¸' : 'æœ‰è¯¯' }}\r\n            </span>\r\n          </div>\r\n          \r\n          <!-- é¥²æ–™é‡é‡ -->\r\n          <div class=\"card feed-card\">\r\n            <div>é¥²æ–™é‡é‡çŠ¶æ€å€¼</div>\r\n            <div class=\"progress-container\">\r\n              <div class=\"progress-bar\" :style=\"{ height: barHeight + 'px' }\">\r\n                <div \r\n                  class=\"progress-fill\" \r\n                  :class=\"{ low: weightPercent < 20 }\"\r\n                  :style=\"{ \r\n                    height: weightPercent + '%',\r\n                    background: gradientBg \r\n                  }\"\r\n                ></div>\r\n                <div \r\n                  class=\"progress-marker\"\r\n                  :style=\"{ bottom: weightPercent + '%' }\"\r\n                ></div>\r\n              </div>\r\n              <div class=\"weight-info\">\r\n                <span>{{ weight.toFixed(1) }}g</span>\r\n                <span>{{ weightPercent }}%</span>\r\n                <span v-if=\"weightPercent < 20\" class=\"low-warning\">\r\n                  é¥²æ–™ä¸è¶³ï¼Œè¯·è¡¥å……!\r\n                </span>\r\n              </div>\r\n            </div>\r\n          </div>\r\n          \r\n          <!-- æ°´æ³µè®¾å¤‡ -->\r\n          <div class=\"card device-card\">\r\n            <div class=\"icon\">ğŸ’§</div>\r\n            <div>æ°´æ³µçŠ¶æ€</div>\r\n            <span class=\"status\" :class=\"{ on: devices[0].status === 1 }\">\r\n              {{ devices[0].status === 1 ? 'è¿è¡Œä¸­' : 'å·²å…³é—­' }}\r\n            </span>\r\n          </div>\r\n          \r\n          <!-- ç”µæœºè®¾å¤‡ -->\r\n          <div class=\"card device-card\">\r\n            <div class=\"icon\">ğŸ”Š</div>\r\n            <div>ç”µæœºçŠ¶æ€</div>\r\n            <span class=\"status\" :class=\"{ on: devices[1].status === 1 }\">\r\n              {{ devices[1].status === 1 ? 'è¿è¡Œä¸­' : 'å·²å…³é—­' }}\r\n            </span>\r\n          </div>\r\n          \r\n          <!-- ç¯å…‰è®¾å¤‡ -->\r\n          <div class=\"card device-card\">\r\n            <div class=\"icon\">ğŸ’¡</div>\r\n            <div>ç¯å…‰çŠ¶æ€</div>\r\n            <span class=\"status\" :class=\"{ on: devices[2].status === 1 }\">\r\n              {{ devices[2].status === 1 ? 'è¿è¡Œä¸­' : 'å·²å…³é—­' }}\r\n            </span>\r\n          </div>\r\n          \r\n          <!-- é˜€é—¨è®¾å¤‡ -->\r\n          <div class=\"card device-card\">\r\n            <div class=\"icon\">ğŸšª</div>\r\n            <div>é˜€é—¨çŠ¶æ€</div>\r\n            <span class=\"status\" :class=\"{ on: devices[3].status === 1 }\">\r\n              {{ devices[3].status === 1 ? 'è¿è¡Œä¸­' : 'å·²å…³é—­' }}\r\n            </span>\r\n          </div>\r\n          \r\n          <!-- åŠ çƒ­è®¾å¤‡ -->\r\n          <div class=\"card device-card\">\r\n            <div class=\"icon\">ğŸ”¥</div>\r\n            <div>åŠ çƒ­çŠ¶æ€</div>\r\n            <span class=\"status\" :class=\"{ on: devices[4].status === 1 }\">\r\n              {{ devices[4].status === 1 ? 'è¿è¡Œä¸­' : 'å·²å…³é—­' }}\r\n            </span>\r\n          </div>\r\n          \r\n          <!-- é£æœºè®¾å¤‡ -->\r\n          <div class=\"card device-card\">\r\n            <div class=\"icon\">ğŸ’¨</div>\r\n            <div>é£æœºçŠ¶æ€</div>\r\n            <span class=\"status\" :class=\"{ on: devices[5].status === 1 }\">\r\n              {{ devices[5].status === 1 ? 'è¿è¡Œä¸­' : 'å·²å…³é—­' }}\r\n            </span>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </section>\r\n\r\n      <!-- åœ°å›¾åŒºåŸŸ -->\r\n      <section class=\"map-section\">\r\n        <h2>ä½ç½®ç›‘æ§</h2>\r\n        <div class=\"map-container\">\r\n          <div id=\"map\" class=\"map-view\"></div>\r\n          <div class=\"map-status\">\r\n            <span>åœ°å›¾åç«¯è¿æ¥: </span>\r\n            <span :class=\"{ online: mapConn }\">{{ mapConn ? 'å·²è¿æ¥' : 'å·²æ–­å¼€' }}</span>\r\n            <span class=\"map-dot\" :class=\"{ green: mapConn }\"></span>\r\n          </div>\r\n          <div class=\"map-data\">\r\n            <div><span>ç»çº¬åº¦:</span> <span>{{ lnglat || 'ç­‰å¾…æ•°æ®...' }}</span></div>\r\n            <div><span>èˆªå‘è§’:</span> <span>{{ course || '0Â°' }}</span></div>\r\n            <div><span>åœ°å›¾çŠ¶æ€:</span> <span>{{ mapStatus }}</span></div>\r\n          </div>\r\n        </div>\r\n      </section>\r\n    </main>\r\n\r\n    <footer class=\"footer\">\r\n      <div>æœ€åæ›´æ–°æ—¶é—´: {{ lastUpdate }}</div>\r\n      <button class=\"refresh\" @click=\"refresh\">\r\n        <i class=\"fa fa-refresh\"></i> åˆ·æ–°æ•°æ®\r\n      </button>\r\n    </footer>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport * as echarts from 'echarts'\r\nimport markerIcon from '@/assets/imgs/icons8-åœˆå‘ä¸Š-64.png'\r\n\r\nexport default {\r\n  name: 'FarmMonitor', // é¿å…ä½¿ç”¨HTMLä¿ç•™æ ‡ç­¾ä½œä¸ºç»„ä»¶å\r\n  data() {\r\n    return {\r\n      // æ ¸å¿ƒæ•°æ®\r\n      weather: {\r\n        date: `${new Date().getMonth() + 1}æœˆ${new Date().getDate()}æ—¥`,\r\n        weekday: ['å‘¨æ—¥', 'å‘¨ä¸€', 'å‘¨äºŒ', 'å‘¨ä¸‰', 'å‘¨å››', 'å‘¨äº”', 'å‘¨å…­'][new Date().getDay()],\r\n        weather: 'æ™´',\r\n        tempMin: 18,\r\n        tempMax: 30,\r\n        windDir: 'ä¸œé£',\r\n        windForce: '3çº§'\r\n      },\r\n      currDate: new Date().toLocaleDateString(),\r\n      temp: 22,\r\n      hum: 50,\r\n      tempHistory: [{ time: '00:00', value: 22 }, { time: '00:05', value: 22.5 }],\r\n      humHistory: [{ time: '00:00', value: 50 }, { time: '00:05', value: 49.5 }],\r\n      tempRange: { min: 18, max: 26 },\r\n      humRange: { min: 40, max: 60 },\r\n\r\n      // æ–°å¢WebSocketå’ŒWorkerç›¸å…³çŠ¶æ€\r\n      worker: null,\r\n      workerPort: null,\r\n      // è®¾å¤‡æ•°æ®\r\n      water: { status: 0, value: 0 },\r\n      weight: 50,\r\n      devices: [\r\n        { name: 'æ°´æ³µ', status: 0 },\r\n        { name: 'ç”µæœº', status: 0 },\r\n        { name: 'ç¯å…‰', status: 0 },\r\n        { name: 'é˜€é—¨', status: 0 },\r\n        { name: 'åŠ çƒ­', status: 0 },\r\n        { name: 'é£æœº', status: 0 }\r\n      ],\r\n\r\n      // è¿æ¥çŠ¶æ€\r\n      mainConn: false,\r\n      lastUpdate: '-',\r\n      maxHistory: 10,\r\n\r\n      // è¿›åº¦æ¡ç›¸å…³é…ç½®\r\n      barHeight: 120, // è¿›åº¦æ¡é«˜åº¦\r\n      colors: ['#43a047', '#8bc34a', '#cddc39'], // è¿›åº¦æ¡æ¸å˜é¢œè‰²\r\n\r\n      // åœ°å›¾ç›¸å…³\r\n      lnglat: '',\r\n      course: '',\r\n      mapStatus: 'åœ°å›¾åŠ è½½ä¸­...',\r\n      mapConn: false,\r\n      map: null,\r\n      marker: null,\r\n\r\n      // å›¾è¡¨å®ä¾‹\r\n      tempChart: null,\r\n      humChart: null\r\n    }\r\n  },\r\n  computed: {\r\n    // è®¡ç®—å±æ€§ï¼ˆVue 2 ä¸­ä½¿ç”¨ function è¯­æ³•ï¼‰\r\n    weightPercent() {\r\n      return Math.max(0, Math.min(100, Math.round(this.weight)))\r\n    },\r\n    tempWarn() {\r\n      return this.temp < this.tempRange.min || this.temp > this.tempRange.max\r\n    },\r\n    humWarn() {\r\n      return this.hum < this.humRange.min || this.hum > this.humRange.max\r\n    },\r\n    waterAlarm() {\r\n      return this.water.value > 8.5 || this.water.value < 2.0\r\n    },\r\n    gradientBg() {\r\n      return `linear-gradient(to top, ${this.colors.join(', ')})`\r\n    }\r\n  },\r\n  methods: {\r\n    // å›¾è¡¨åˆå§‹åŒ–ä¸æ¸²æŸ“\r\n    initCharts() {\r\n      const tempDom = document.getElementById('tempChart')\r\n      const humDom = document.getElementById('humChart')\r\n      if (!tempDom || !humDom) return\r\n\r\n      this.tempChart = echarts.init(tempDom)\r\n      this.humChart = echarts.init(humDom)\r\n      \r\n      window.addEventListener('resize', () => {\r\n        this.tempChart?.resize()\r\n        this.humChart?.resize()\r\n      })\r\n      this.renderCharts()\r\n    },\r\n    renderCharts() {\r\n      // æ¸©åº¦å›¾è¡¨é…ç½®\r\n      this.tempChart.setOption({\r\n        tooltip: { trigger: 'axis' },\r\n        grid: { left: '3%', right: '4%', bottom: '3%', containLabel: true },\r\n        xAxis: { \r\n          type: 'category', \r\n          data: this.tempHistory.map(i => i.time),\r\n          axisLabel: { rotate: 30 } \r\n        },\r\n        yAxis: {\r\n          type: 'value',\r\n          name: 'æ¸©åº¦(Â°C)',\r\n          min: Math.min(...this.tempHistory.map(i => i.value), this.tempRange.min) - 2,\r\n          max: Math.max(...this.tempHistory.map(i => i.value), this.tempRange.max) + 2,\r\n          markLine: {\r\n            data: [\r\n              { yAxis: this.tempRange.min, name: 'æœ€ä½é˜ˆå€¼', lineStyle: { color: 'red' } },\r\n              { yAxis: this.tempRange.max, name: 'æœ€é«˜é˜ˆå€¼', lineStyle: { color: 'red' } }\r\n            ]\r\n          }\r\n        },\r\n        series: [{\r\n          name: 'æ¸©åº¦',\r\n          type: 'line',\r\n          data: this.tempHistory.map(i => i.value),\r\n          smooth: true,\r\n          lineStyle: { color: '#e74c3c' },\r\n          itemStyle: { color: '#e74c3c' },\r\n          areaStyle: { color: new echarts.graphic.LinearGradient(0,0,0,1,[\r\n            { offset: 0, color: 'rgba(231,76,60,0.3)' },\r\n            { offset: 1, color: 'rgba(231,76,60,0)' }\r\n          ])}\r\n        }]\r\n      })\r\n\r\n      // æ¹¿åº¦å›¾è¡¨é…ç½®\r\n      this.humChart.setOption({\r\n        tooltip: { trigger: 'axis' },\r\n        grid: { left: '3%', right: '4%', bottom: '3%', containLabel: true },\r\n        xAxis: { type: 'category', data: this.humHistory.map(i => i.time), axisLabel: { rotate: 30 } },\r\n        yAxis: {\r\n          type: 'value',\r\n          name: 'æ¹¿åº¦(%)',\r\n          min: Math.min(...this.humHistory.map(i => i.value), this.humRange.min) - 5,\r\n          max: Math.max(...this.humHistory.map(i => i.value), this.humRange.max) + 5,\r\n          markLine: {\r\n            data: [\r\n              { yAxis: this.humRange.min, name: 'æœ€ä½é˜ˆå€¼', lineStyle: { color: 'blue' } },\r\n              { yAxis: this.humRange.max, name: 'æœ€é«˜é˜ˆå€¼', lineStyle: { color: 'blue' } }\r\n            ]\r\n          }\r\n        },\r\n        series: [{\r\n          name: 'æ¹¿åº¦',\r\n          type: 'line',\r\n          data: this.humHistory.map(i => i.value),\r\n          smooth: true,\r\n          lineStyle: { color: '#3498db' },\r\n          itemStyle: { color: '#3498db' },\r\n          areaStyle: { color: new echarts.graphic.LinearGradient(0,0,0,1,[\r\n            { offset: 0, color: 'rgba(52,152,219,0.3)' },\r\n            { offset: 1, color: 'rgba(52,152,219,0)' }\r\n          ])}\r\n        }]\r\n      })\r\n    },\r\n\r\n    // å†å²æ•°æ®æ›´æ–°\r\n    updateHistory(ref, val, time) {\r\n      ref.push({ time, value: val })\r\n      if (ref.length > this.maxHistory) ref.shift()\r\n    },\r\n\r\n    // åœ°å›¾åˆå§‹åŒ–\r\n    initMap() {\r\n      const loadMap = () => new Promise((res, rej) => {\r\n        if (window.AMap) return res(window.AMap)\r\n        const script = document.createElement('script')\r\n        script.src = 'https://webapi.amap.com/maps?v=1.4.15&key=ä½ çš„é«˜å¾·Key' // æ›¿æ¢ä¸ºä½ çš„é«˜å¾·Key\r\n        script.onload = () => res(window.AMap || rej(new Error('åœ°å›¾åŠ è½½å¤±è´¥')))\r\n        script.onerror = () => rej(new Error('åœ°å›¾è„šæœ¬åŠ è½½å¤±è´¥'))\r\n        document.head.appendChild(script)\r\n      })\r\n\r\n      loadMap().then(AMap => {\r\n        this.map = new AMap.Map('map', {\r\n          resizeEnable: true,\r\n          zoom: 16,\r\n          center: [116.397470, 39.908823],\r\n          viewMode: '2D'\r\n        })\r\n        \r\n        this.marker = new AMap.Marker({\r\n          position: [116.397470, 39.908823],\r\n          icon: new AMap.Icon({\r\n            size: new AMap.Size(32, 32),\r\n            image: markerIcon,\r\n            imageSize: new AMap.Size(64, 64),\r\n            imageOffset: new AMap.Pixel(-16, -16)\r\n          }),\r\n          anchor: 'center'\r\n        })\r\n        this.map.add(this.marker)\r\n        \r\n        this.map.on('complete', () => this.mapStatus = 'åœ°å›¾å·²å°±ç»ª')\r\n        this.map.on('error', () => this.mapStatus = 'åœ°å›¾æ¸²æŸ“é”™è¯¯')\r\n      }).catch(err => {\r\n        this.mapStatus = 'åœ°å›¾åŠ è½½å¤±è´¥'\r\n        console.error(err)\r\n      })\r\n    },\r\n\r\n    // æ•°æ®åˆ·æ–°\r\n    // æ–°å¢: åˆå§‹åŒ–SharedWorker\r\n    initWorker() {\r\n      if (!window.SharedWorker) {\r\n        console.error('å½“å‰æµè§ˆå™¨ä¸æ”¯æŒSharedWorker');\r\n        return;\r\n      }\r\n\r\n      try {\r\n        this.worker = new SharedWorker('/websocket-shared-worker.js');\r\n        this.workerPort = this.worker.port;\r\n\r\n        // ç›‘å¬Workeræ¶ˆæ¯\r\n        this.workerPort.onmessage = (event) => {\r\n          this.handleWorkerMessage(event.data);\r\n        };\r\n\r\n        // ç›‘å¬é”™è¯¯\r\n        this.workerPort.onerror = (error) => {\r\n          console.error('Worker error:', error);\r\n          this.mainConn = false;\r\n          this.mapConn = false;\r\n        };\r\n\r\n        // å¯åŠ¨è¿æ¥\r\n        this.workerPort.start();\r\n      } catch (error) {\r\n        console.error('åˆå§‹åŒ–SharedWorkerå¤±è´¥:', error);\r\n      }\r\n    },\r\n\r\n    // æ–°å¢: å¤„ç†Workeræ¶ˆæ¯\r\n    handleWorkerMessage(message) {\r\n      switch (message.type) {\r\n        case 'CONNECTED':\r\n          this.mainConn = true;\r\n          this.mapConn = true;\r\n          break;\r\n        case 'DISCONNECTED':\r\n          this.mainConn = false;\r\n          this.mapConn = false;\r\n          break;\r\n        case 'ERROR':\r\n          console.error('WebSocketé”™è¯¯:', message.data);\r\n          this.mainConn = false;\r\n          this.mapConn = false;\r\n          break;\r\n        case 'MAIN_DATA':\r\n          this.handleMainData(message.data);\r\n          break;\r\n        case 'MAP_DATA':\r\n          this.handleMapData(message.data);\r\n          break;\r\n        default:\r\n          console.log('æœªçŸ¥æ¶ˆæ¯ç±»å‹:', message.type);\r\n      }\r\n    },\r\n\r\n    // ä¿®æ”¹: æ•°æ®åˆ·æ–°æ–¹æ³•\r\n    refresh() {\r\n      if (this.workerPort) {\r\n        this.workerPort.postMessage({ type: 'REFRESH_DATA' });\r\n        this.lastUpdate = new Date().toLocaleString();\r\n      }\r\n    },\r\n\r\n    // å¤„ç†ä¸»æ•°æ®æ›´æ–°çš„å›è°ƒå‡½æ•°\r\n    handleMainData(data) {\r\n      try {\r\n        this.temp = data.T || data.tem || this.temp\r\n        this.hum = data.H || data.hum || this.hum\r\n        \r\n        this.water = {\r\n          status: data.waterStatus || 0,\r\n          value: data.water_level || 0\r\n        }\r\n        \r\n        this.weight = Math.max(0, Math.min(100, parseFloat(data.weight) || 0))\r\n\r\n        // æ›´æ–°è®¾å¤‡çŠ¶æ€\r\n        this.devices.find(d => d.name === 'æ°´æ³µ').status = data.pump || 0\r\n        this.devices.find(d => d.name === 'ç”µæœº').status = data.motor || 0\r\n        this.devices.find(d => d.name === 'ç¯å…‰').status = data.light || 0\r\n        this.devices.find(d => d.name === 'é˜€é—¨').status = data.door || 0\r\n        this.devices.find(d => d.name === 'åŠ çƒ­').status = data.heat || 0\r\n        this.devices.find(d => d.name === 'é£æœº').status = data.fan || 0\r\n        \r\n        // æ›´æ–°å†å²æ•°æ®\r\n        const timeStr = new Date().toLocaleTimeString()\r\n        this.updateHistory(this.tempHistory, this.temp, timeStr)\r\n        this.updateHistory(this.humHistory, this.hum, timeStr)\r\n        \r\n        this.lastUpdate = new Date().toLocaleString()\r\n        this.currDate = new Date().toLocaleDateString()\r\n        this.renderCharts()\r\n        this.mainConn = true\r\n      } catch (e) {\r\n        this.mainConn = false\r\n        console.error('å¤„ç†ä¸»æ•°æ®å¤±è´¥:', e)\r\n      }\r\n    },\r\n\r\n    // å¤„ç†åœ°å›¾æ•°æ®æ›´æ–°çš„å›è°ƒå‡½æ•°\r\n    handleMapData(data) {\r\n      try {\r\n        if (data.lng !== undefined && data.lat !== undefined) {\r\n          const lng = parseFloat(data.lng), lat = parseFloat(data.lat)\r\n          if (!isNaN(lng) && !isNaN(lat) && lng >= -180 && lng <= 180 && lat >= -90 && lat <= 90) {\r\n            this.lnglat = `${lng.toFixed(6)},${lat.toFixed(6)}`\r\n            this.marker?.setPosition([lng + 0.01, lat - 0.001])\r\n            this.map?.panTo([lng + 0.01, lat - 0.001], { duration: 300 })\r\n          }\r\n        }\r\n        if (data.cogt !== undefined) {\r\n          const angle = parseFloat(data.cogt)\r\n          if (!isNaN(angle)) {\r\n            this.course = `${angle.toFixed(1)}Â°`\r\n            this.marker?.setRotation(((angle % 360) + 360) % 360)\r\n          }\r\n        }\r\n        this.mapConn = true\r\n      } catch (e) {\r\n        this.mapConn = false\r\n        console.error('å¤„ç†åœ°å›¾æ•°æ®å¤±è´¥:', e)\r\n      }\r\n    },\r\n\r\n    // å¤„ç†è¿æ¥çŠ¶æ€å˜åŒ–\r\n    handleConnectionStatus(status) {\r\n      this.mainConn = status\r\n      this.mapConn = status\r\n    }\r\n  },\r\n  mounted() {\r\n    // Vue 2 ä¸­ä½¿ç”¨ $nextTick\r\n    this.$nextTick(() => {\r\n      this.initCharts()\r\n      this.initMap()\r\n      \r\n      // åˆå§‹åŒ–SharedWorker\r\n      this.initWorker()\r\n    })\r\n  },\r\n  beforeDestroy() {\r\n    // æ¸…ç†Workerè¿æ¥\r\n    if (this.workerPort) {\r\n      this.workerPort.close();\r\n      this.worker = null;\r\n      this.workerPort = null;\r\n    }\r\n\r\n    // æ¸…ç†å›¾è¡¨å’Œåœ°å›¾\r\n    if (this.tempChart) this.tempChart.dispose()\r\n    if (this.humChart) this.humChart.dispose()\r\n    if (this.map) this.map.destroy()\r\n  }\r\n}\r\n</script>\r\n\r\n<style scoped>\r\n/* æ ·å¼ä¿æŒä¸å˜ */\r\n* { margin: 0; padding: 0; box-sizing: border-box; }\r\n.dashboard { font-family: 'Microsoft YaHei', sans-serif; display: flex; flex-direction: column; background: #f5f7fa; min-height: 100vh; }\r\n\r\n/* é¡¶éƒ¨æ  */\r\n.top-bar { display: flex; justify-content: space-between; align-items: center; padding: 1rem 2rem; background: #2c3e50; color: #fff; box-shadow: 0 2px 4px rgba(0,0,0,0.1); flex-wrap: wrap; gap: 1rem; }\r\n.weather-info { display: flex; gap: 1.5rem; font-size: 0.9rem; color: #e0e0e0; }\r\n.conn-status { display: flex; align-items: center; gap: 0.5rem; }\r\n.dot { display: inline-block; width: 10px; height: 10px; border-radius: 50%; background: #e74c3c; }\r\n.dot.green { background: #27ae60; }\r\n.currDate { font-size: 0.9rem; }\r\n\r\n/* ä¸»å†…å®¹åŒº */\r\n.main-content { flex: 1; padding: 1.5rem 2rem; display: flex; flex-direction: column; gap: 2rem; overflow-y: auto; }\r\nh2 { font-size: 1.2rem; color: #2c3e50; margin-bottom: 1rem; padding-bottom: 0.5rem; border-bottom: 1px solid #e0e0e0; }\r\n\r\n/* çŠ¶æ€å¡ç‰‡ */\r\n.status-cards .cards { display: grid; grid-template-columns: repeat(2, 1fr); gap: 1rem; height: 140px; }\r\n.card { background: #fff; border-radius: 6px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); padding: 1rem; display: flex; flex-direction: column; justify-content: center; gap: 0.5rem; }\r\n.card.warn { border-left: 4px solid #e74c3c; }\r\n.card .val { font-size: 1.8rem; font-weight: bold; color: #2c3e50; }\r\n\r\n/* å›¾è¡¨åŒºåŸŸ */\r\n.charts .charts-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 1.5rem; height: 400px; }\r\n.chart-box .chart { width: 100%; height: 100%; min-height: 250px; }\r\n\r\n\r\n.device-info .info-grid {\r\n  height: auto;\r\n  padding: 1rem;\r\n  background: #fff;\r\n  border-radius: 6px;\r\n  box-shadow: 0 2px 4px rgba(0,0,0,0.1);\r\n}\r\n\r\n.device-grid {\r\n  display: grid;\r\n  grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));\r\n  gap: 1.2rem;\r\n}\r\n\r\n/* è®¾å¤‡å¡ç‰‡é€šç”¨æ ·å¼ */\r\n.device-grid .card {\r\n  height: 100%;\r\n  left: 30%;\r\n  min-height: 120px;\r\n  display: flex;\r\n  flex-direction: column;\r\n  justify-content: center;\r\n  align-items: center;\r\n  text-align: center;\r\n  padding: 1rem;\r\n  transition: transform 0.2s ease;\r\n}\r\n\r\n.device-grid .card:hover {\r\n  transform: translateY(-3px);\r\n  box-shadow: 0 4px 8px rgba(0,0,0,0.15);\r\n}\r\n\r\n/* è®¾å¤‡å›¾æ ‡æ ·å¼ */\r\n.device-card .icon {\r\n  font-size: 1.8rem;\r\n  margin-bottom: 0.5rem;\r\n}\r\n\r\n/* é¥²æ–™å¡ç‰‡ç‰¹æ®Šè°ƒæ•´ */\r\n.feed-card {\r\n  grid-column: span 2;\r\n  min-height: 160px;\r\n}\r\n\r\n/* å“åº”å¼è°ƒæ•´ */\r\n@media (max-width: 768px) {\r\n  .device-grid {\r\n    grid-template-columns: 1fr 1fr;\r\n  }\r\n  \r\n  .feed-card {\r\n    grid-column: span 2;\r\n  }\r\n}\r\n\r\n@media (max-width: 480px) {\r\n  .device-grid {\r\n    grid-template-columns: 1fr;\r\n  }\r\n  \r\n  .feed-card {\r\n    grid-column: span 1;\r\n  }\r\n}\r\n\r\n/* é¥²æ–™é‡é‡è¿›åº¦æ¡æ ·å¼ */\r\n.feed-card .progress-container { display: flex; align-items: center; gap: 1rem; justify-content: center; flex: 1; }\r\n.progress-bar {\r\n  width: 60px;\r\n  border: 2px solid #e0e0e0;\r\n  border-radius: 10px;\r\n  position: relative;\r\n  background-color: #f5f5f5;\r\n  box-shadow: 0 0 10px rgba(0, 0, 0, 0.1) inset;\r\n}\r\n.progress-fill {\r\n  width: 100%;\r\n  position: absolute;\r\n  bottom: 0;\r\n  transition: height 0.8s ease;\r\n  border-radius: 8px;\r\n}\r\n.progress-marker {\r\n  position: absolute;\r\n  width: 100%;\r\n  height: 3px;\r\n  background-color: #333;\r\n  transform: translateY(50%);\r\n  box-shadow: 0 0 5px rgba(0, 0, 0, 0.3);\r\n}\r\n.progress-fill.low { \r\n  background: linear-gradient(to top, #e74c3c, #ff5252) !important;\r\n  animation: pulse 1.5s infinite; \r\n}\r\n.weight-info { \r\n  display: flex; \r\n  flex-direction: column; \r\n  gap: 0.5rem; \r\n  align-items: center; \r\n}\r\n.weight-info span {\r\n  font-weight: 500;\r\n}\r\n.low-warning {\r\n  color: #e74c3c;\r\n  font-size: 0.8rem;\r\n  font-weight: bold;\r\n  animation: shake 1s infinite;\r\n}\r\n\r\n/* è®¾å¤‡åˆ—è¡¨ */\r\n.device-list { display: flex; flex-direction: column; gap: 0.8rem; }\r\n.device-item { padding: 0.6rem 0.8rem; border-radius: 4px; background: #fafafa; font-size: 0.9rem; display: flex; align-items: center; gap: 0.8rem; }\r\n.icon { font-size: 1.1rem; }\r\n.status { font-weight: 500; }\r\n.status.on { color: #27ae60; }\r\n\r\n/* åœ°å›¾åŒºåŸŸ */\r\n.map-container { width: 100%; height: 600px; position: relative; border-radius: 6px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); overflow: hidden; }\r\n.map-view { width: 100%; height: 100%; }\r\n.map-status { position: absolute; top: 15px; right: 15px; background: rgba(255,255,255,0.9); padding: 0.5rem 1rem; border-radius: 4px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); font-size: 0.85rem; }\r\n.map-dot { display: inline-block; width: 8px; height: 8px; border-radius: 50%; background: #e74c3c; margin-left: 5px; }\r\n.map-dot.green { background: #27ae60; }\r\n.map-data { position: absolute; bottom: 15px; left: 15px; background: rgba(255,255,255,0.9); padding: 0.8rem; border-radius: 6px; box-shadow: 0 2px 8px rgba(0,0,0,0.15); font-size: 0.9rem; display: flex; gap: 1.5rem; }\r\n.map-data > div { display: flex; gap: 0.5rem; }\r\n\r\n/* åº•éƒ¨åŒºåŸŸ */\r\n.footer { height: 50px; display: flex; justify-content: space-between; align-items: center; padding: 0 2rem; background: #2c3e50; color: #fff; font-size: 0.9rem; }\r\n.refresh { background: #3498db; color: #fff; border: none; border-radius: 4px; padding: 0.4rem 0.8rem; display: flex; align-items: center; gap: 0.5rem; cursor: pointer; }\r\n.refresh:hover { background: #2980b9; }\r\n\r\n/* å“åº”å¼ */\r\n@media (max-width: 768px) {\r\n  .charts-grid { grid-template-columns: 1fr; height: auto; gap: 1rem; }\r\n  .chart-box { height: 400px; }\r\n  .info-grid { flex-direction: column; height: auto; gap: 1rem; }\r\n  .status-group, .device-list { height: auto; min-height: 300px; }\r\n  .map-container { height: 400px; }\r\n}\r\n\r\n/* åŠ¨ç”»æ•ˆæœ */\r\n@keyframes pulse { \r\n  0% { opacity: 1; } \r\n  50% { opacity: 0.6; } \r\n  100% { opacity: 1; } \r\n}\r\n\r\n@keyframes shake {\r\n  0%, 100% { transform: translateX(0); }\r\n  25% { transform: translateX(-3px); }\r\n  75% { transform: translateX(3px); }\r\n}\r\n</style>"],"mappings":";;;;AAg6BA,YAAAA,OAAA;AACA,OAAAC,UAAA;AAEA;EACAC,IAAA;EAAA;EACAC,KAAA;IACA;MACA;MACAC,OAAA;QACAC,IAAA,SAAAC,IAAA,GAAAC,QAAA,cAAAD,IAAA,GAAAE,OAAA;QACAC,OAAA,iDAAAH,IAAA,GAAAI,MAAA;QACAN,OAAA;QACAO,OAAA;QACAC,OAAA;QACAC,OAAA;QACAC,SAAA;MACA;MACAC,QAAA,MAAAT,IAAA,GAAAU,kBAAA;MACAC,IAAA;MACAC,GAAA;MACAC,WAAA;QAAAC,IAAA;QAAAC,KAAA;MAAA;QAAAD,IAAA;QAAAC,KAAA;MAAA;MACAC,UAAA;QAAAF,IAAA;QAAAC,KAAA;MAAA;QAAAD,IAAA;QAAAC,KAAA;MAAA;MACAE,SAAA;QAAAC,GAAA;QAAAC,GAAA;MAAA;MACAC,QAAA;QAAAF,GAAA;QAAAC,GAAA;MAAA;MAEA;MACAE,MAAA;MACAC,UAAA;MACA;MACAC,KAAA;QAAAC,MAAA;QAAAT,KAAA;MAAA;MACAU,MAAA;MACAC,OAAA,GACA;QAAA9B,IAAA;QAAA4B,MAAA;MAAA,GACA;QAAA5B,IAAA;QAAA4B,MAAA;MAAA,GACA;QAAA5B,IAAA;QAAA4B,MAAA;MAAA,GACA;QAAA5B,IAAA;QAAA4B,MAAA;MAAA,GACA;QAAA5B,IAAA;QAAA4B,MAAA;MAAA,GACA;QAAA5B,IAAA;QAAA4B,MAAA;MAAA,EACA;MAEA;MACAG,QAAA;MACAC,UAAA;MACAC,UAAA;MAEA;MACAC,SAAA;MAAA;MACAC,MAAA;MAAA;;MAEA;MACAC,MAAA;MACAC,MAAA;MACAC,SAAA;MACAC,OAAA;MACAC,GAAA;MACAC,MAAA;MAEA;MACAC,SAAA;MACAC,QAAA;IACA;EACA;EACAC,QAAA;IACA;IACAC,cAAA;MACA,OAAAC,IAAA,CAAAvB,GAAA,IAAAuB,IAAA,CAAAxB,GAAA,MAAAwB,IAAA,CAAAC,KAAA,MAAAlB,MAAA;IACA;IACAmB,SAAA;MACA,YAAAjC,IAAA,QAAAM,SAAA,CAAAC,GAAA,SAAAP,IAAA,QAAAM,SAAA,CAAAE,GAAA;IACA;IACA0B,QAAA;MACA,YAAAjC,GAAA,QAAAQ,QAAA,CAAAF,GAAA,SAAAN,GAAA,QAAAQ,QAAA,CAAAD,GAAA;IACA;IACA2B,WAAA;MACA,YAAAvB,KAAA,CAAAR,KAAA,eAAAQ,KAAA,CAAAR,KAAA;IACA;IACAgC,WAAA;MACA,uCAAAhB,MAAA,CAAAiB,IAAA;IACA;EACA;EACAC,OAAA;IACA;IACAC,WAAA;MACA,MAAAC,OAAA,GAAAC,QAAA,CAAAC,cAAA;MACA,MAAAC,MAAA,GAAAF,QAAA,CAAAC,cAAA;MACA,KAAAF,OAAA,KAAAG,MAAA;MAEA,KAAAhB,SAAA,GAAA5C,OAAA,CAAA6D,IAAA,CAAAJ,OAAA;MACA,KAAAZ,QAAA,GAAA7C,OAAA,CAAA6D,IAAA,CAAAD,MAAA;MAEAE,MAAA,CAAAC,gBAAA;QACA,KAAAnB,SAAA,EAAAoB,MAAA;QACA,KAAAnB,QAAA,EAAAmB,MAAA;MACA;MACA,KAAAC,YAAA;IACA;IACAA,aAAA;MACA;MACA,KAAArB,SAAA,CAAAsB,SAAA;QACAC,OAAA;UAAAC,OAAA;QAAA;QACAC,IAAA;UAAAC,IAAA;UAAAC,KAAA;UAAAC,MAAA;UAAAC,YAAA;QAAA;QACAC,KAAA;UACAC,IAAA;UACAxE,IAAA,OAAAgB,WAAA,CAAAuB,GAAA,CAAAkC,CAAA,IAAAA,CAAA,CAAAxD,IAAA;UACAyD,SAAA;YAAAC,MAAA;UAAA;QACA;QACAC,KAAA;UACAJ,IAAA;UACAzE,IAAA;UACAsB,GAAA,EAAAwB,IAAA,CAAAxB,GAAA,SAAAL,WAAA,CAAAuB,GAAA,CAAAkC,CAAA,IAAAA,CAAA,CAAAvD,KAAA,QAAAE,SAAA,CAAAC,GAAA;UACAC,GAAA,EAAAuB,IAAA,CAAAvB,GAAA,SAAAN,WAAA,CAAAuB,GAAA,CAAAkC,CAAA,IAAAA,CAAA,CAAAvD,KAAA,QAAAE,SAAA,CAAAE,GAAA;UACAuD,QAAA;YACA7E,IAAA,GACA;cAAA4E,KAAA,OAAAxD,SAAA,CAAAC,GAAA;cAAAtB,IAAA;cAAA+E,SAAA;gBAAAC,KAAA;cAAA;YAAA,GACA;cAAAH,KAAA,OAAAxD,SAAA,CAAAE,GAAA;cAAAvB,IAAA;cAAA+E,SAAA;gBAAAC,KAAA;cAAA;YAAA;UAEA;QACA;QACAC,MAAA;UACAjF,IAAA;UACAyE,IAAA;UACAxE,IAAA,OAAAgB,WAAA,CAAAuB,GAAA,CAAAkC,CAAA,IAAAA,CAAA,CAAAvD,KAAA;UACA+D,MAAA;UACAH,SAAA;YAAAC,KAAA;UAAA;UACAG,SAAA;YAAAH,KAAA;UAAA;UACAI,SAAA;YAAAJ,KAAA,MAAAlF,OAAA,CAAAuF,OAAA,CAAAC,cAAA,cACA;cAAAC,MAAA;cAAAP,KAAA;YAAA,GACA;cAAAO,MAAA;cAAAP,KAAA;YAAA,EACA;UAAA;QACA;MACA;;MAEA;MACA,KAAArC,QAAA,CAAAqB,SAAA;QACAC,OAAA;UAAAC,OAAA;QAAA;QACAC,IAAA;UAAAC,IAAA;UAAAC,KAAA;UAAAC,MAAA;UAAAC,YAAA;QAAA;QACAC,KAAA;UAAAC,IAAA;UAAAxE,IAAA,OAAAmB,UAAA,CAAAoB,GAAA,CAAAkC,CAAA,IAAAA,CAAA,CAAAxD,IAAA;UAAAyD,SAAA;YAAAC,MAAA;UAAA;QAAA;QACAC,KAAA;UACAJ,IAAA;UACAzE,IAAA;UACAsB,GAAA,EAAAwB,IAAA,CAAAxB,GAAA,SAAAF,UAAA,CAAAoB,GAAA,CAAAkC,CAAA,IAAAA,CAAA,CAAAvD,KAAA,QAAAK,QAAA,CAAAF,GAAA;UACAC,GAAA,EAAAuB,IAAA,CAAAvB,GAAA,SAAAH,UAAA,CAAAoB,GAAA,CAAAkC,CAAA,IAAAA,CAAA,CAAAvD,KAAA,QAAAK,QAAA,CAAAD,GAAA;UACAuD,QAAA;YACA7E,IAAA,GACA;cAAA4E,KAAA,OAAArD,QAAA,CAAAF,GAAA;cAAAtB,IAAA;cAAA+E,SAAA;gBAAAC,KAAA;cAAA;YAAA,GACA;cAAAH,KAAA,OAAArD,QAAA,CAAAD,GAAA;cAAAvB,IAAA;cAAA+E,SAAA;gBAAAC,KAAA;cAAA;YAAA;UAEA;QACA;QACAC,MAAA;UACAjF,IAAA;UACAyE,IAAA;UACAxE,IAAA,OAAAmB,UAAA,CAAAoB,GAAA,CAAAkC,CAAA,IAAAA,CAAA,CAAAvD,KAAA;UACA+D,MAAA;UACAH,SAAA;YAAAC,KAAA;UAAA;UACAG,SAAA;YAAAH,KAAA;UAAA;UACAI,SAAA;YAAAJ,KAAA,MAAAlF,OAAA,CAAAuF,OAAA,CAAAC,cAAA,cACA;cAAAC,MAAA;cAAAP,KAAA;YAAA,GACA;cAAAO,MAAA;cAAAP,KAAA;YAAA,EACA;UAAA;QACA;MACA;IACA;IAEA;IACAQ,cAAAC,GAAA,EAAAC,GAAA,EAAAxE,IAAA;MACAuE,GAAA,CAAAE,IAAA;QAAAzE,IAAA;QAAAC,KAAA,EAAAuE;MAAA;MACA,IAAAD,GAAA,CAAAG,MAAA,QAAA3D,UAAA,EAAAwD,GAAA,CAAAI,KAAA;IACA;IAEA;IACAC,QAAA;MACA,MAAAC,OAAA,GAAAA,CAAA,SAAAC,OAAA,EAAAC,GAAA,EAAAC,GAAA;QACA,IAAAtC,MAAA,CAAAuC,IAAA,SAAAF,GAAA,CAAArC,MAAA,CAAAuC,IAAA;QACA,MAAAC,MAAA,GAAA5C,QAAA,CAAA6C,aAAA;QACAD,MAAA,CAAAE,GAAA;QACAF,MAAA,CAAAG,MAAA,SAAAN,GAAA,CAAArC,MAAA,CAAAuC,IAAA,IAAAD,GAAA,KAAAM,KAAA;QACAJ,MAAA,CAAAK,OAAA,SAAAP,GAAA,KAAAM,KAAA;QACAhD,QAAA,CAAAkD,IAAA,CAAAC,WAAA,CAAAP,MAAA;MACA;MAEAL,OAAA,GAAAa,IAAA,CAAAT,IAAA;QACA,KAAA3D,GAAA,OAAA2D,IAAA,CAAAU,GAAA;UACAC,YAAA;UACAC,IAAA;UACAC,MAAA;UACAC,QAAA;QACA;QAEA,KAAAxE,MAAA,OAAA0D,IAAA,CAAAe,MAAA;UACAC,QAAA;UACAC,IAAA,MAAAjB,IAAA,CAAAkB,IAAA;YACAC,IAAA,MAAAnB,IAAA,CAAAoB,IAAA;YACAC,KAAA,EAAAzH,UAAA;YACA0H,SAAA,MAAAtB,IAAA,CAAAoB,IAAA;YACAG,WAAA,MAAAvB,IAAA,CAAAwB,KAAA;UACA;UACAC,MAAA;QACA;QACA,KAAApF,GAAA,CAAAqF,GAAA,MAAApF,MAAA;QAEA,KAAAD,GAAA,CAAAsF,EAAA,wBAAAxF,SAAA;QACA,KAAAE,GAAA,CAAAsF,EAAA,qBAAAxF,SAAA;MACA,GAAAyF,KAAA,CAAAC,GAAA;QACA,KAAA1F,SAAA;QACA2F,OAAA,CAAAC,KAAA,CAAAF,GAAA;MACA;IACA;IAEA;IACA;IACAG,WAAA;MACA,KAAAvE,MAAA,CAAAwE,YAAA;QACAH,OAAA,CAAAC,KAAA;QACA;MACA;MAEA;QACA,KAAAzG,MAAA,OAAA2G,YAAA;QACA,KAAA1G,UAAA,QAAAD,MAAA,CAAA4G,IAAA;;QAEA;QACA,KAAA3G,UAAA,CAAA4G,SAAA,GAAAC,KAAA;UACA,KAAAC,mBAAA,CAAAD,KAAA,CAAAtI,IAAA;QACA;;QAEA;QACA,KAAAyB,UAAA,CAAA+E,OAAA,GAAAyB,KAAA;UACAD,OAAA,CAAAC,KAAA,kBAAAA,KAAA;UACA,KAAAnG,QAAA;UACA,KAAAQ,OAAA;QACA;;QAEA;QACA,KAAAb,UAAA,CAAA+G,KAAA;MACA,SAAAP,KAAA;QACAD,OAAA,CAAAC,KAAA,uBAAAA,KAAA;MACA;IACA;IAEA;IACAM,oBAAAE,OAAA;MACA,QAAAA,OAAA,CAAAjE,IAAA;QACA;UACA,KAAA1C,QAAA;UACA,KAAAQ,OAAA;UACA;QACA;UACA,KAAAR,QAAA;UACA,KAAAQ,OAAA;UACA;QACA;UACA0F,OAAA,CAAAC,KAAA,iBAAAQ,OAAA,CAAAzI,IAAA;UACA,KAAA8B,QAAA;UACA,KAAAQ,OAAA;UACA;QACA;UACA,KAAAoG,cAAA,CAAAD,OAAA,CAAAzI,IAAA;UACA;QACA;UACA,KAAA2I,aAAA,CAAAF,OAAA,CAAAzI,IAAA;UACA;QACA;UACAgI,OAAA,CAAAY,GAAA,YAAAH,OAAA,CAAAjE,IAAA;MACA;IACA;IAEA;IACAqE,QAAA;MACA,SAAApH,UAAA;QACA,KAAAA,UAAA,CAAAqH,WAAA;UAAAtE,IAAA;QAAA;QACA,KAAAzC,UAAA,OAAA5B,IAAA,GAAA4I,cAAA;MACA;IACA;IAEA;IACAL,eAAA1I,IAAA;MACA;QACA,KAAAc,IAAA,GAAAd,IAAA,CAAAgJ,CAAA,IAAAhJ,IAAA,CAAAiJ,GAAA,SAAAnI,IAAA;QACA,KAAAC,GAAA,GAAAf,IAAA,CAAAkJ,CAAA,IAAAlJ,IAAA,CAAAe,GAAA,SAAAA,GAAA;QAEA,KAAAW,KAAA;UACAC,MAAA,EAAA3B,IAAA,CAAAmJ,WAAA;UACAjI,KAAA,EAAAlB,IAAA,CAAAoJ,WAAA;QACA;QAEA,KAAAxH,MAAA,GAAAiB,IAAA,CAAAvB,GAAA,IAAAuB,IAAA,CAAAxB,GAAA,MAAAgI,UAAA,CAAArJ,IAAA,CAAA4B,MAAA;;QAEA;QACA,KAAAC,OAAA,CAAAyH,IAAA,CAAAC,CAAA,IAAAA,CAAA,CAAAxJ,IAAA,WAAA4B,MAAA,GAAA3B,IAAA,CAAAwJ,IAAA;QACA,KAAA3H,OAAA,CAAAyH,IAAA,CAAAC,CAAA,IAAAA,CAAA,CAAAxJ,IAAA,WAAA4B,MAAA,GAAA3B,IAAA,CAAAyJ,KAAA;QACA,KAAA5H,OAAA,CAAAyH,IAAA,CAAAC,CAAA,IAAAA,CAAA,CAAAxJ,IAAA,WAAA4B,MAAA,GAAA3B,IAAA,CAAA0J,KAAA;QACA,KAAA7H,OAAA,CAAAyH,IAAA,CAAAC,CAAA,IAAAA,CAAA,CAAAxJ,IAAA,WAAA4B,MAAA,GAAA3B,IAAA,CAAA2J,IAAA;QACA,KAAA9H,OAAA,CAAAyH,IAAA,CAAAC,CAAA,IAAAA,CAAA,CAAAxJ,IAAA,WAAA4B,MAAA,GAAA3B,IAAA,CAAA4J,IAAA;QACA,KAAA/H,OAAA,CAAAyH,IAAA,CAAAC,CAAA,IAAAA,CAAA,CAAAxJ,IAAA,WAAA4B,MAAA,GAAA3B,IAAA,CAAA6J,GAAA;;QAEA;QACA,MAAAC,OAAA,OAAA3J,IAAA,GAAA4J,kBAAA;QACA,KAAAxE,aAAA,MAAAvE,WAAA,OAAAF,IAAA,EAAAgJ,OAAA;QACA,KAAAvE,aAAA,MAAApE,UAAA,OAAAJ,GAAA,EAAA+I,OAAA;QAEA,KAAA/H,UAAA,OAAA5B,IAAA,GAAA4I,cAAA;QACA,KAAAnI,QAAA,OAAAT,IAAA,GAAAU,kBAAA;QACA,KAAAiD,YAAA;QACA,KAAAhC,QAAA;MACA,SAAAkI,CAAA;QACA,KAAAlI,QAAA;QACAkG,OAAA,CAAAC,KAAA,aAAA+B,CAAA;MACA;IACA;IAEA;IACArB,cAAA3I,IAAA;MACA;QACA,IAAAA,IAAA,CAAAiK,GAAA,KAAAC,SAAA,IAAAlK,IAAA,CAAAmK,GAAA,KAAAD,SAAA;UACA,MAAAD,GAAA,GAAAZ,UAAA,CAAArJ,IAAA,CAAAiK,GAAA;YAAAE,GAAA,GAAAd,UAAA,CAAArJ,IAAA,CAAAmK,GAAA;UACA,KAAAC,KAAA,CAAAH,GAAA,MAAAG,KAAA,CAAAD,GAAA,KAAAF,GAAA,YAAAA,GAAA,WAAAE,GAAA,WAAAA,GAAA;YACA,KAAAhI,MAAA,MAAA8H,GAAA,CAAAI,OAAA,OAAAF,GAAA,CAAAE,OAAA;YACA,KAAA7H,MAAA,EAAA8H,WAAA,EAAAL,GAAA,SAAAE,GAAA;YACA,KAAA5H,GAAA,EAAAgI,KAAA,EAAAN,GAAA,SAAAE,GAAA;cAAAK,QAAA;YAAA;UACA;QACA;QACA,IAAAxK,IAAA,CAAAyK,IAAA,KAAAP,SAAA;UACA,MAAAQ,KAAA,GAAArB,UAAA,CAAArJ,IAAA,CAAAyK,IAAA;UACA,KAAAL,KAAA,CAAAM,KAAA;YACA,KAAAtI,MAAA,MAAAsI,KAAA,CAAAL,OAAA;YACA,KAAA7H,MAAA,EAAAmI,WAAA,EAAAD,KAAA;UACA;QACA;QACA,KAAApI,OAAA;MACA,SAAA0H,CAAA;QACA,KAAA1H,OAAA;QACA0F,OAAA,CAAAC,KAAA,cAAA+B,CAAA;MACA;IACA;IAEA;IACAY,uBAAAjJ,MAAA;MACA,KAAAG,QAAA,GAAAH,MAAA;MACA,KAAAW,OAAA,GAAAX,MAAA;IACA;EACA;EACAkJ,QAAA;IACA;IACA,KAAAC,SAAA;MACA,KAAAzH,UAAA;MACA,KAAAwC,OAAA;;MAEA;MACA,KAAAqC,UAAA;IACA;EACA;EACA6C,cAAA;IACA;IACA,SAAAtJ,UAAA;MACA,KAAAA,UAAA,CAAAuJ,KAAA;MACA,KAAAxJ,MAAA;MACA,KAAAC,UAAA;IACA;;IAEA;IACA,SAAAgB,SAAA,OAAAA,SAAA,CAAAwI,OAAA;IACA,SAAAvI,QAAA,OAAAA,QAAA,CAAAuI,OAAA;IACA,SAAA1I,GAAA,OAAAA,GAAA,CAAA2I,OAAA;EACA;AACA","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}