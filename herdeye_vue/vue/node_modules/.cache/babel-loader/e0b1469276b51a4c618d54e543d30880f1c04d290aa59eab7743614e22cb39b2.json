{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport \"core-js/modules/es.iterator.constructor.js\";\nimport \"core-js/modules/es.iterator.for-each.js\";\nimport axios from \"axios\";\nexport default {\n  name: 'Home',\n  data() {\n    return {\n      updateTime: new Date().toLocaleString(),\n      streams: {\n        drone: {\n          isStreaming: false,\n          src: '',\n          latestUrl: '',\n          isLoading: false,\n          intervals: {\n            refresh: null,\n            detection: null\n          }\n        },\n        ground: {\n          isStreaming: false,\n          src: '',\n          latestUrl: '',\n          isLoading: false,\n          intervals: {\n            refresh: null,\n            detection: null\n          }\n        }\n      }\n    };\n  },\n  methods: {\n    // 跳转GPS页面\n    navigateToGPS() {\n      this.$router.push('/GPS');\n    },\n    // 切换视频流状态\n    toggleStream(type) {\n      this.streams[type].isStreaming ? this.stopStream(type) : this.startStream(type);\n    },\n    // 启动视频流\n    startStream(type) {\n      const stream = this.streams[type];\n      stream.isStreaming = true;\n      stream.src = `http://localhost:5000/video_feed?type=${type}&t=${Date.now()}`;\n\n      // 清除旧定时器\n      Object.values(stream.intervals).forEach(interval => interval && clearInterval(interval));\n    },\n    // 停止视频流\n    async stopStream(type) {\n      const stream = this.streams[type];\n      stream.isStreaming = false;\n      stream.src = '';\n\n      // 清除检测轮询\n      clearInterval(stream.intervals.detection);\n\n      // 获取最新视频并启动刷新轮询\n      await this.fetchLatestVideo(type);\n      stream.intervals.refresh = setInterval(() => !stream.isStreaming && this.fetchLatestVideo(type), 5000);\n    },\n    // 获取最新录制视频\n    async fetchLatestVideo(type) {\n      try {\n        const res = await this.$request.get(`http://localhost:5000/latest_video?type=${type}`);\n        this.streams[type].latestUrl = res.url;\n      } catch (error) {\n        console.error(`${type === 'drone' ? '无人机' : '地面端'}视频获取失败`, error);\n      }\n    }\n  },\n  // 清理定时器\n  beforeUnmount() {\n    Object.values(this.streams).forEach(stream => {\n      Object.values(stream.intervals).forEach(interval => interval && clearInterval(interval));\n    });\n  },\n  // 初始化时间更新\n  created() {\n    setInterval(() => this.updateTime = new Date().toLocaleString(), 60000);\n  }\n};","map":{"version":3,"names":["axios","name","data","updateTime","Date","toLocaleString","streams","drone","isStreaming","src","latestUrl","isLoading","intervals","refresh","detection","ground","methods","navigateToGPS","$router","push","toggleStream","type","stopStream","startStream","stream","now","Object","values","forEach","interval","clearInterval","fetchLatestVideo","setInterval","res","$request","get","url","error","console","beforeUnmount","created"],"sources":["src/views/manager/video.vue"],"sourcesContent":["<template>\r\n  <div class=\"pasture-eye-page\">\r\n    <!-- 页面标题区域 -->\r\n    <header class=\"page-header\">\r\n      <h1 class=\"page-title\">牧瞳系统</h1>\r\n      <div class=\"page-meta\">\r\n        <span class=\"update-time\">上次更新：{{ updateTime }}</span>\r\n      </div>\r\n    </header>\r\n\r\n    <!-- 检测功能模块 -->\r\n    <el-card class=\"detection-card\">\r\n      <!-- 视频流容器 - 并排显示 -->\r\n      <div class=\"videos-container\">\r\n        <!-- 无人机视频流 -->\r\n        <div class=\"video-module\">\r\n          <div class=\"detection-header\">\r\n            <span class=\"video-title\">无人机视频</span>\r\n            <el-button\r\n              :type=\"streams.drone.isStreaming ? 'danger' : 'success'\"\r\n              @click=\"toggleStream('drone')\"\r\n              style=\"margin-left: 10px\"\r\n            >\r\n              {{ streams.drone.isStreaming ? '关闭视频' : '开启视频' }}\r\n            </el-button>\r\n          </div>\r\n\r\n          <div class=\"video-container\">\r\n            <img\r\n              :src=\"streams.drone.src\"\r\n              class=\"video-stream\"\r\n              v-show=\"streams.drone.isStreaming\"\r\n              alt=\"无人机视频流\"\r\n            />\r\n            <div v-show=\"!streams.drone.isStreaming && streams.drone.latestUrl\" class=\"video-links\">\r\n              <h3>无人机录制视频</h3>\r\n              <el-link :href=\"streams.drone.latestUrl\" target=\"_blank\" type=\"primary\">\r\n                下载最新视频 <i class=\"el-icon-download\"></i>\r\n              </el-link>\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        <!-- 地面端视频流 -->\r\n        <div class=\"video-module\">\r\n          <div class=\"detection-header\">\r\n            <span class=\"video-title\">地面端视频</span>\r\n            <el-button\r\n              :type=\"streams.ground.isStreaming ? 'danger' : 'success'\"\r\n              @click=\"toggleStream('ground')\"\r\n              style=\"margin-left: 10px\"\r\n            >\r\n              {{ streams.ground.isStreaming ? '关闭视频' : '开启视频' }}\r\n            </el-button>\r\n          </div>\r\n\r\n          <div class=\"video-container\">\r\n            <img\r\n              :src=\"streams.ground.src\"\r\n              class=\"video-stream\"\r\n              v-show=\"streams.ground.isStreaming\"\r\n              alt=\"地面端视频流\"\r\n            />\r\n            <div v-show=\"!streams.ground.isStreaming && streams.ground.latestUrl\" class=\"video-links\">\r\n              <h3>地面端录制视频</h3>\r\n              <el-link :href=\"streams.ground.latestUrl\" target=\"_blank\" type=\"primary\">\r\n                下载最新视频 <i class=\"el-icon-download\"></i>\r\n              </el-link>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </el-card>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport axios from \"axios\";\r\n\r\nexport default {\r\n  name: 'Home',\r\n  data() {\r\n    return {\r\n      updateTime: new Date().toLocaleString(),\r\n      streams: { \r\n        drone: {\r\n          isStreaming: false,\r\n          src: '',\r\n          latestUrl: '',\r\n          isLoading: false,\r\n          intervals: { refresh: null, detection: null }\r\n        },\r\n        ground: {\r\n          isStreaming: false,\r\n          src: '',\r\n          latestUrl: '',\r\n          isLoading: false,\r\n          intervals: { refresh: null, detection: null }\r\n        }\r\n      }\r\n    };\r\n  },\r\n  methods: {\r\n    // 跳转GPS页面\r\n    navigateToGPS() {\r\n      this.$router.push('/GPS');\r\n    },\r\n\r\n    // 切换视频流状态\r\n    toggleStream(type) {\r\n      this.streams[type].isStreaming ? this.stopStream(type) : this.startStream(type);\r\n    },\r\n\r\n    // 启动视频流\r\n    startStream(type) {\r\n      const stream = this.streams[type];\r\n      stream.isStreaming = true;\r\n      stream.src = `http://localhost:5000/video_feed?type=${type}&t=${Date.now()}`;\r\n      \r\n      // 清除旧定时器\r\n      Object.values(stream.intervals).forEach(interval => interval && clearInterval(interval));\r\n    },\r\n\r\n    // 停止视频流\r\n    async stopStream(type) {\r\n      const stream = this.streams[type];\r\n      stream.isStreaming = false;\r\n      stream.src = '';\r\n      \r\n      // 清除检测轮询\r\n      clearInterval(stream.intervals.detection);\r\n      \r\n      // 获取最新视频并启动刷新轮询\r\n      await this.fetchLatestVideo(type);\r\n      stream.intervals.refresh = setInterval(() => !stream.isStreaming && this.fetchLatestVideo(type), 5000);\r\n    },\r\n\r\n    // 获取最新录制视频\r\n    async fetchLatestVideo(type) {\r\n      try {\r\n        const res = await this.$request.get(`http://localhost:5000/latest_video?type=${type}`);\r\n        this.streams[type].latestUrl = res.url;\r\n      } catch (error) {\r\n        console.error(`${type === 'drone' ? '无人机' : '地面端'}视频获取失败`, error);\r\n      }\r\n    }\r\n  },\r\n  // 清理定时器\r\n  beforeUnmount() {\r\n    Object.values(this.streams).forEach(stream => {\r\n      Object.values(stream.intervals).forEach(interval => interval && clearInterval(interval));\r\n    });\r\n  },\r\n  // 初始化时间更新\r\n  created() {\r\n    setInterval(() => this.updateTime = new Date().toLocaleString(), 60000);\r\n  }\r\n};\r\n</script>\r\n\r\n<style scoped>\r\n.pasture-eye-page {\r\n  padding: 20px;\r\n}\r\n\r\n.page-header {\r\n  display: flex;\r\n  justify-content: space-between;\r\n  align-items: center;\r\n  margin-bottom: 25px;\r\n  padding-bottom: 15px;\r\n  border-bottom: 1px solid #f0f2f5;\r\n}\r\n\r\n.page-title {\r\n  margin: 0;\r\n  font-size: 20px;\r\n  color: #2c3e50;\r\n}\r\n\r\n.page-meta {\r\n  color: #606266;\r\n  font-size: 14px;\r\n}\r\n\r\n.detection-card {\r\n  padding: 25px;\r\n  border-radius: 6px;\r\n  box-shadow: 0 2px 12px rgba(0, 0, 0, 0.05);\r\n}\r\n\r\n.videos-container {\r\n  display: flex;\r\n  gap: 20px;\r\n  width: 100%;\r\n}\r\n\r\n.video-module {\r\n  flex: 1;\r\n  margin-bottom: 0;\r\n  padding-bottom: 0;\r\n}\r\n\r\n.detection-header {\r\n  display: flex;\r\n  align-items: center;\r\n  margin-bottom: 18px;\r\n}\r\n\r\n.video-title {\r\n  font-size: 16px;\r\n  font-weight: 500;\r\n  color: #303133;\r\n}\r\n\r\n.video-container {\r\n  border: 1px solid #ebeef5;\r\n  border-radius: 6px;\r\n  padding: 15px;\r\n  background-color: #fafafa;\r\n  margin-bottom: 20px;\r\n  min-height: 400px;\r\n  display: flex;\r\n  flex-direction: column;\r\n  justify-content: center;\r\n  align-items: center;\r\n}\r\n\r\n.video-stream {\r\n  max-width: 100%;\r\n  height: auto;\r\n  min-height: 350px;\r\n  object-fit: contain;\r\n  border-radius: 4px;\r\n}\r\n\r\n.video-links {\r\n  text-align: center;\r\n  padding: 20px;\r\n}\r\n\r\n.video-links h3 {\r\n  margin-bottom: 15px;\r\n  font-size: 16px;\r\n  color: #303133;\r\n}\r\n\r\n/* 响应式调整 */\r\n@media (max-width: 768px) {\r\n  .page-header {\r\n    flex-direction: column;\r\n    align-items: flex-start;\r\n    gap: 15px;\r\n    margin-bottom: 20px;\r\n  }\r\n  \r\n  .videos-container {\r\n    flex-direction: column;\r\n    gap: 30px;\r\n  }\r\n  \r\n  .video-module {\r\n    margin-bottom: 0;\r\n  }\r\n  \r\n  .detection-card {\r\n    padding: 15px;\r\n  }\r\n  \r\n  .video-container {\r\n    min-height: 250px;\r\n    margin-bottom: 15px;\r\n  }\r\n}\r\n</style>\r\n"],"mappings":";;;AA6EA,OAAAA,KAAA;AAEA;EACAC,IAAA;EACAC,KAAA;IACA;MACAC,UAAA,MAAAC,IAAA,GAAAC,cAAA;MACAC,OAAA;QACAC,KAAA;UACAC,WAAA;UACAC,GAAA;UACAC,SAAA;UACAC,SAAA;UACAC,SAAA;YAAAC,OAAA;YAAAC,SAAA;UAAA;QACA;QACAC,MAAA;UACAP,WAAA;UACAC,GAAA;UACAC,SAAA;UACAC,SAAA;UACAC,SAAA;YAAAC,OAAA;YAAAC,SAAA;UAAA;QACA;MACA;IACA;EACA;EACAE,OAAA;IACA;IACAC,cAAA;MACA,KAAAC,OAAA,CAAAC,IAAA;IACA;IAEA;IACAC,aAAAC,IAAA;MACA,KAAAf,OAAA,CAAAe,IAAA,EAAAb,WAAA,QAAAc,UAAA,CAAAD,IAAA,SAAAE,WAAA,CAAAF,IAAA;IACA;IAEA;IACAE,YAAAF,IAAA;MACA,MAAAG,MAAA,QAAAlB,OAAA,CAAAe,IAAA;MACAG,MAAA,CAAAhB,WAAA;MACAgB,MAAA,CAAAf,GAAA,4CAAAY,IAAA,MAAAjB,IAAA,CAAAqB,GAAA;;MAEA;MACAC,MAAA,CAAAC,MAAA,CAAAH,MAAA,CAAAZ,SAAA,EAAAgB,OAAA,CAAAC,QAAA,IAAAA,QAAA,IAAAC,aAAA,CAAAD,QAAA;IACA;IAEA;IACA,MAAAP,WAAAD,IAAA;MACA,MAAAG,MAAA,QAAAlB,OAAA,CAAAe,IAAA;MACAG,MAAA,CAAAhB,WAAA;MACAgB,MAAA,CAAAf,GAAA;;MAEA;MACAqB,aAAA,CAAAN,MAAA,CAAAZ,SAAA,CAAAE,SAAA;;MAEA;MACA,WAAAiB,gBAAA,CAAAV,IAAA;MACAG,MAAA,CAAAZ,SAAA,CAAAC,OAAA,GAAAmB,WAAA,QAAAR,MAAA,CAAAhB,WAAA,SAAAuB,gBAAA,CAAAV,IAAA;IACA;IAEA;IACA,MAAAU,iBAAAV,IAAA;MACA;QACA,MAAAY,GAAA,cAAAC,QAAA,CAAAC,GAAA,4CAAAd,IAAA;QACA,KAAAf,OAAA,CAAAe,IAAA,EAAAX,SAAA,GAAAuB,GAAA,CAAAG,GAAA;MACA,SAAAC,KAAA;QACAC,OAAA,CAAAD,KAAA,IAAAhB,IAAA,sCAAAgB,KAAA;MACA;IACA;EACA;EACA;EACAE,cAAA;IACAb,MAAA,CAAAC,MAAA,MAAArB,OAAA,EAAAsB,OAAA,CAAAJ,MAAA;MACAE,MAAA,CAAAC,MAAA,CAAAH,MAAA,CAAAZ,SAAA,EAAAgB,OAAA,CAAAC,QAAA,IAAAA,QAAA,IAAAC,aAAA,CAAAD,QAAA;IACA;EACA;EACA;EACAW,QAAA;IACAR,WAAA,YAAA7B,UAAA,OAAAC,IAAA,GAAAC,cAAA;EACA;AACA","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}